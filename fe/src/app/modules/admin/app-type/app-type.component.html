<div class="flex-auto pt-3 sm:px-6 overflow-hidden max-h-screen">
    <div class="relative w-full flex-1 h-full flex flex-col">
        <div class="flex items-center justify-between text-lg">
            <h2 class="text-[24px] font-bold text-primary">
                {{ translocoService.translate("app_type.title") }}
            </h2>
        </div>
        <div class="flex flex-row justify-between gap-2 my-4">
            <div class="relative w-80">
                <!-- Khối input -->
                <div class="flex items-center h-full border border-primary rounded-md bg-white px-2 py-1">
                    <mat-icon [svgIcon]="'heroicons_outline:magnifying-glass'"
                        class="text-primary text-2xl mr-2"></mat-icon>
                    <input type="text"
                        class="flex-1 border-0 outline-none bg-transparent text-gray-700 text-base placeholder-gray-400"
                        [placeholder]="translocoService.translate('app_type.search_placeholder')"
                        [(ngModel)]="searchText" (ngModelChange)="onSearchChange()" />

                    <!-- Nút X -->
                    <button *ngIf="searchText" type="button" (click)="clearSearch()"
                        class="p-1 flex items-center justify-center rounded hover:bg-gray-200 transition">
                        <mat-icon [svgIcon]="'heroicons_outline:x-mark'" class="text-primary"></mat-icon>
                    </button>
                </div>
                
            </div>
            <div class=" text-gray-400 w-80">
                <div class="relative">
                    <mat-icon class="absolute text-gray-400 -translate-y-1/2 left-2 top-1/2">search</mat-icon>
                    <input
                        type="text"
                        [(ngModel)]="searchText"
                        (ngModelChange)="onSearchChange()"
                        placeholder="{{ translocoService.translate('user_management.search_placeholder') }}"
                        class="h-9 sm:h-9 text-sm sm:text-base text-black pl-10 pr-10 py-2 border border-gray-300 rounded-lg w-full sm:w-[300px] lg:w-[400px]"
                    />
                    <!-- <button
                        class="absolute right-0 top-1/2 -translate-y-1/2 rounded-md p-1 flex items-center justify-center bg-[#E0EAFF] border border-[#E0EAFF] hover:bg-[#e6f0ff] transition"
                        (click)="toggleEditFilterDrawer(); $event.stopPropagation()"
                        type="button"
                    >
                        <mat-icon [svgIcon]="'heroicons_outline:funnel'"></mat-icon>
                    </button> -->
                    <!-- <app-filter-user
                        #filterPopup
                        [mode]="'inline'"
                        (filter)="onApplyUserFilter($event)"
                        (close)="showFilter = false"
                        [ngClass]="{ 'hidden': !showFilter }"
                        class="absolute top-[40px] sm:top-[50px] z-50 left-0 bg-white shadow-lg rounded-md w-full sm:w-[300px] lg:w-[400px] max-h-[400px] flex flex-col overflow-y-auto"
                    >
                    </app-filter-user> -->

                </div>
            </div>
            
            <!-- nút tạo mới -->
            <button
                class="flex items-center gap-2 bg-primary text-white h-9 px-3 rounded-md shadow hover:bg-primary-700 transition"
                (click)="openAddAppPopup()">
                <span class="material-icons">add</span>
                <span class="lg:text-base text-sm">
                    {{ translocoService.translate('app_type.btn_create') | titlecase}}
                </span>
            </button>
        </div>
        <!-- nút xóa -->
        <!-- <div *ngIf="checkboxSelected.length > 0" class="flex items-center gap-2 select-none cursor-pointer" (click)="openDeleteAllPopup()">
            <mat-icon class="text-red-600 w-2 h-2" [svgIcon]="'heroicons_outline:trash'" style="font-size: 2.5rem;"> </mat-icon>
            <span class="text-red-600 font-bold text-sm">{{ translocoService.translate('app_type.delete') }}</span>
        </div> -->
        <div class="flex flex-wrap items-center gap-2 pb-2">
            <!-- Nút sửa -->
            <!-- <div *ngIf="checkboxSelected.length === 1"
                class="flex items-center bg-blue-100 text-blue-600 px-2 py-1 gap-1 rounded text-sm cursor-pointer"
                (click)="openUpdateAppPopup(checkboxSelected[0])">
                <span class="material-icons text-base">edit</span>
                <span class="font-semibold">{{ translocoService.translate('app_type.btn_update') }}</span>
            </div> -->

            <!-- Nút khóa -->
            <div *ngIf="checkboxSelected.length > 0 && hasUnlockedApps"
                class="flex items-center bg-red-100 text-red-600 px-2 py-1 gap-1 rounded text-sm cursor-pointer"
                (click)="lockSelectedApps()">
                <span class="material-icons text-base">lock</span>
                <span class="font-semibold">{{ translocoService.translate('app_type.lock') }}</span>
            </div>

            <!-- Nút mở khóa -->
            <div *ngIf="checkboxSelected.length > 0 && hasLockedApps"
                class="flex items-center bg-green-100 text-green-600 px-2 py-1 gap-1 rounded text-sm cursor-pointer"
                (click)="unlockSelectedApps()">
                <span class="material-icons text-base">lock_open</span>
                <span class="font-semibold">{{ translocoService.translate('app_type.unlock') }}</span>
            </div>
        </div>


        <!-- table -->
        <div class="h-table-body-15">
            <div class="bg-white overflow-x-auto h-full mb-3">
                <table class="table w-full border-separate border-spacing-0 text-base">
                    <thead class="font-medium text-gray-700 text-left bg-sky-50">
                        <tr>
                            <th class="th-cell p-3 text-center border-b w-10">
                                <input type="checkbox" class="form-checkbox h-4 w-4 text-primary-600"
                                    [checked]="isAllSelected()" (change)="onCheckboxChangeAll($event)" />
                            </th>
                            <th class="th-cell p-3 border-b w-10">STT
                            </th>
                            <th class="th-cell p-3 text-start border-b w-20">Logo
                            </th>
                            <th class="th-cell p-3 border-b cursor-pointer" (click)="sortBy('title')" [ngClass]="{
                                'bg-primary-100': sortField === 'title'
                            }">
                                <span class="flex items-center">
                                    {{
                                    translocoService.translate("app_type.title_field")
                                    | titlecase
                                    }}
                                    <div class="flex flex-col ml-2">
                                        <!-- Khi chưa sort, hiển thị cả hai icon gần nhau -->
                                        <ng-container *ngIf="
                                                sortField !== 'title' ||
                                                sortOption === null
                                            ">
                                            <span class="material-icons leading-none h-4 text-base"
                                                style="line-height: 1">arrow_drop_up</span>
                                            <span class="material-icons leading-none h-4 text-base" style="
                                                    line-height: 1;
                                                    margin-top: -8px;
                                                ">arrow_drop_down</span>
                                        </ng-container>
                                        <!-- Khi sort asc -->
                                        <ng-container *ngIf="
                                                sortField === 'title' &&
                                                sortOption === 'asc'
                                            ">
                                            <span class="material-icons leading-none h-4 text-base"
                                                style="line-height: 1">arrow_drop_up</span>
                                        </ng-container>
                                        <!-- Khi sort desc -->
                                        <ng-container *ngIf="
                                                sortField === 'title' &&
                                                sortOption === 'desc'
                                            ">
                                            <span class="material-icons leading-none h-4 text-base"
                                                style="line-height: 1">arrow_drop_down</span>
                                        </ng-container>
                                    </div>
                                </span>
                            </th>
                            <th class="th-cell p-3 border-b min-w-30 cursor-pointer" (click)="sortBy('industry')" [ngClass]="{
                                'bg-primary-100': sortField === 'industry'
                            }">
                                <span class="flex items-center">
                                    {{
                                    translocoService.translate("app_type.industry")
                                    | titlecase
                                    }}
                                    <div class="flex flex-col ml-2">
                                        <!-- Khi chưa sort, hiển thị cả hai icon gần nhau -->
                                        <ng-container *ngIf="
                                                sortField !== 'industry' ||
                                                sortOption === null
                                            ">
                                            <span class="material-icons leading-none h-4 text-base"
                                                style="line-height: 1">arrow_drop_up</span>
                                            <span class="material-icons leading-none h-4 text-base" style="
                                                    line-height: 1;
                                                    margin-top: -8px;
                                                ">arrow_drop_down</span>
                                        </ng-container>
                                        <!-- Khi sort asc -->
                                        <ng-container *ngIf="
                                                sortField === 'industry' &&
                                                sortOption === 'asc'
                                            ">
                                            <span class="material-icons leading-none h-4 text-base"
                                                style="line-height: 1">arrow_drop_up</span>
                                        </ng-container>
                                        <!-- Khi sort desc -->
                                        <ng-container *ngIf="
                                                sortField === 'industry' &&
                                                sortOption === 'desc'
                                            ">
                                            <span class="material-icons leading-none h-4 text-base"
                                                style="line-height: 1">arrow_drop_down</span>
                                        </ng-container>
                                    </div>
                                </span>
                            </th>
                            <th class="th-cell p-3 border-b cursor-pointer" (click)="sortBy('created_at')" [ngClass]="{
                                    'bg-primary-100': sortField === 'created_at'
                                }">
                                <span class="flex items-center">
                                    {{
                                    translocoService.translate("app_type.created_at")
                                    | titlecase
                                    }}
                                    <div class="flex flex-col ml-2">
                                        <!-- Khi chưa sort, hiển thị cả hai icon gần nhau -->
                                        <ng-container *ngIf="
                                                sortField !== 'created_at' ||
                                                sortOption === null
                                            ">
                                            <span class="material-icons leading-none h-4 text-base"
                                                style="line-height: 1">arrow_drop_up</span>
                                            <span class="material-icons leading-none h-4 text-base" style="
                                                    line-height: 1;
                                                    margin-top: -8px;
                                                ">arrow_drop_down</span>
                                        </ng-container>
                                        <!-- Khi sort asc -->
                                        <ng-container *ngIf="
                                                sortField === 'created_at' &&
                                                sortOption === 'asc'
                                            ">
                                            <span class="material-icons leading-none h-4 text-base"
                                                style="line-height: 1">arrow_drop_up</span>
                                        </ng-container>
                                        <!-- Khi sort desc -->
                                        <ng-container *ngIf="
                                                sortField === 'created_at' &&
                                                sortOption === 'desc'
                                            ">
                                            <span class="material-icons leading-none h-4 text-base"
                                                style="line-height: 1">arrow_drop_down</span>
                                        </ng-container>
                                    </div>
                                </span>
                            </th>
                            <!-- <th class="th-cell p-3 border-b w-1/5 cursor-pointer" (click)="sortBy('status')" [ngClass]="{
                                    'bg-primary-100': sortField === 'status'
                                }">
                                <span class="flex items-center">
                                    {{
                                    translocoService.translate("news.status")
                                    | titlecase
                                    }}
                                    <div class="flex flex-col ml-2">
                                        <ng-container *ngIf="
                                                sortField !== 'status' ||
                                                sortOption === null
                                            ">
                                            <span class="material-icons leading-none h-4 text-base"
                                                style="line-height: 1">arrow_drop_up</span>
                                            <span class="material-icons leading-none h-4 text-base" style="
                                                    line-height: 1;
                                                    margin-top: -8px;
                                                ">arrow_drop_down</span>
                                        </ng-container>
                                        <ng-container *ngIf="
                                                sortField === 'status' &&
                                                sortOption === 'asc'
                                            ">
                                            <span class="material-icons leading-none h-4 text-base"
                                                style="line-height: 1">arrow_drop_up</span>
                                        </ng-container>
                                        <ng-container *ngIf="
                                                sortField === 'status' &&
                                                sortOption === 'desc'
                                            ">
                                            <span class="material-icons leading-none h-4 text-base"
                                                style="line-height: 1">arrow_drop_down</span>
                                        </ng-container>
                                    </div>
                                </span>
                            </th> -->
                            <th class="th-cell p-3 text-start border-b w-30">
                                {{
                                translocoService.translate("app_type.action") | titlecase
                                }}
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let appType of appTypes; let i = index" class="hover:bg-blue-50 transition"
                            [class.opacity-50]="appType.isLocked"
                            [class.pointer-events-none]="appType.isLocked">
                            <td class="td-cell p-3 text-center border-b pointer-events-auto">
                                <input type="checkbox" class="form-checkbox h-4 w-4 text-primary-600"
                                    [checked]="appType.selected" (change)="onCheckboxChange($event, appType)">
                            </td>
                            <td class="td-cell p-3 border-b">
                                {{ (currentPage - 1) * pageSize + i + 1 }}
                            </td>
                            <td class="td-cell p-3 border-b text-center">
                                <img *ngIf="appType.logo" [src]="appType.logo" alt="appType"
                                    class="w-16 h-12 object-scale-down mx-auto">
                            </td>
                            <td class="td-cell p-3 border-b text-gray-600 "><a target="_blank" class="font-bold">{{
                                appType.title | titlecase}}</a>
                            </td>
                            <td class="td-cell min-w-36 max-w-36 whitespace-nowrap text-start font-semibold">
                                <div class="relative w-full" #dropdownRef>
                                    <!-- Dropdown Trigger -->
                                    <button type="button"
                                        class="w-full rounded-lg px-2 py-1 cursor-pointer flex items-center justify-between break-words whitespace-normal gap-1"
                                        [ngClass]="getIndustry(appType.industry, 'class')"
                                        (click)="toggleDropdown(appType.id)"
                                        [attr.aria-expanded]="isDropdownOpen(appType.id)" aria-haspopup="true">
                                        {{ translocoService.translate("app_type." + getIndustry(appType.industry, "name")) }}
                                        <svg class="w-4 h-4 ml-1 transition-transform"
                                            [class.rotate-180]="isDropdownOpen(appType.id)" fill="none"
                                            stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M19 9l-7 7-7-7"></path>
                                        </svg>
                                    </button>
                                    <!-- Dropdown Menu -->
                                    <div *ngIf="isDropdownOpen(appType.id)"
                                        class="absolute top-full left-0 mt-1 bg-white border border-gray-200 rounded-lg shadow-lg z-50 min-w-full">
                                        <div class="py-1">
                                            <button *ngFor="let industry of industryOptions" type="button"
                                                class="w-full px-3 py-2 text-left hover:bg-gray-100 flex items-center gap-2 transition-colors"
                                                [class.text-primary]="industry.id === appType.industry"
                                                (click)="changeIndustry(appType, industry.id)">
                                                {{ translocoService.translate("app_type." + getIndustry(industry.id,
                                                "name")) }}
                                                <span style="font-size: 1rem;" class="text-primary"
                                                    *ngIf="industry.id === appType.industry"
                                                    class="material-icons">check</span>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </td>
                            <td class="td-cell p-3 border-b">
                                {{ appType.createdAt | date : "dd/MM/yyyy HH:mm" }}
                            </td>
                            <!-- <td class="td-cell p-3 border-b">
                                    <button (click)="openAddChildCategoryPopup(parent)"
                                        class="inline-flex items-center justify-center bg-primary text-white rounded-full w-8 h-8 mr-1 hover:bg-primary-500 transition"
                                        title="Thêm con">
                                        <span class="material-icons text-base">add</span>
                                    </button>
                                    <button (click)="openUpdatePopup(parent)"
                                        class="inline-flex items-center justify-center bg-primary-100 text-primary rounded-full w-8 h-8 mr-1 hover:bg-primary-300 transition"
                                        title="Sửa">
                                        <span class="material-icons text-base">edit</span>
                                    </button>
                                    <button (click)="openDeletePopup(parent)"
                                        class="inline-flex items-center justify-center bg-gray-300 text-gray-700 rounded-full w-8 h-8 hover:bg-gray-400 transition"
                                        title="Xóa">
                                        <span class="material-icons text-base">delete</span>
                                    </button>
                                </td> -->
                            <td class="td-cell p-3 border-b pointer-events-auto">
                                <button (click)="openUpdateAppPopup(appType)"
                                    class="inline-flex items-center justify-center w-8 h-8 mr-1"
                                    title="{{ translocoService.translate('app_type.edit') }}">
                                    <img src="assets/images/ui/edit.svg" 
                                        alt="edit" class="w-8 h-8 p-[7px] mx-auto">
                                </button>
                                <button (click)="unlockApp(appType)" *ngIf="appType.isLocked"
                                    class="inline-flex items-center justify-center w-8 h-8 mr-1"
                                    title="{{ translocoService.translate('app_type.lock') }}">
                                    <img src="assets/images/ui/lock.svg" 
                                        alt="appType" class="w-8 h-8 p-[7px] mx-auto">
                                </button>
                                <button (click)="lockApp(appType)" *ngIf="!appType.isLocked"
                                    class="inline-flex items-center justify-center w-8 h-8 mr-1"
                                    title="{{ translocoService.translate('app_type.unlock') }}">
                                    <img src="assets/images/ui/unlock.svg" 
                                    alt="appType" class="w-8 h-8 p-[7px] mx-auto">
                                </button>
                            </td>
                        </tr>
                        <tr *ngIf="appTypes.length === 0">
                            <td colspan="8" class="py-10">
                                <div class="flex flex-col items-center justify-center text-blue-500">
                                    <img src="assets/images/ui/empty-folder-1.svg" alt="Empty" class="w-32 h-32 mb-4" />
                                    <p class="font-semibold">{{ translocoService.translate('errors.fields.empty') }}</p>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <div class="mt-auto flex flex-row items-start justify-between flex-wrap gap-2">
            <span class="text-[#2563EB] text-sm font-medium block">
                {{ translocoService.translate('other.result') }}: {{ totalApps }}/{{ totalApps }}
            </span>
            <app-custom-pagination *ngIf="appTypes.length > 0" [totalRecords]="totalApps" [totalItems]="totalApps"
                [currentPage]="currentPage" [pageSize]="pageSize" (pageChange)="onPageChange($event)"
                (pageSizeChange)="onPageSizeChange($event)">
            </app-custom-pagination>
        </div>
    </div>
</div>
<div *ngIf="showAddAppPopup"
    class="fixed overflow-y-auto inset-0 bg-gray-800 bg-opacity-50 flex flex-col items-center justify-center z-50">
    <div class="flex items-center justify-between pr-4 pl-6 w-[400px] bg-primary text-on-primary rounded-t-lg">
        <div class="text-lg font-medium leading-10 my-2">
        {{ translocoService.translate('app_type.add') | titlecase }}
        </div>
        <span class="material-icons text-white cursor-pointer" (click)="closeAddAppPopup()">close</span>
    </div>
    <div class="bg-white rounded-b-lg shadow-lg p-6 w-[400px] max-h-[80vh] overflow-y-auto">
        <form (ngSubmit)="createApp()">
            <div class="mb-4">
                <label for="add-title" class="block text-sm font-medium text-gray-700">{{
                    translocoService.translate('app_type.title_field') | titlecase}}<span
                        class="text-red-500">*</span></label>
                <input id="add-title" [(ngModel)]="newApp.title" name="update-title" type="text"
                    (ngModelChange)="clearFieldError('title')"
                    [placeholder]="translocoService.translate('app_type.title_placeholder')"
                    class="mt-1 p-2 block w-full border-gray-300 rounded-md shadow-sm focus:ring-primary focus:border-primary">
                <span *ngIf="errorFields['title']" class="text-xs text-red-500 block mt-1">
                    {{ translocoService.translate(errorFields['title']) }}
                </span>
            </div>
            <div class="mb-4">
                <label for="add-describe" class="block text-sm font-medium text-gray-700">{{
                    translocoService.translate('app_type.describe') | titlecase}}</label>
                <input id="add-title" [(ngModel)]="newApp.describe" name="add-describe" type="text"
                    (ngModelChange)="clearFieldError('describe')"
                    [placeholder]="translocoService.translate('app_type.describe_placeholder')"
                    class="mt-1 p-2 block w-full border-gray-300 rounded-md shadow-sm focus:ring-primary focus:border-primary">
            </div>
            <div class="mb-4">
                <label for="add-url" class="block text-sm font-medium text-gray-700">URL<span
                        class="text-red-500">*</span></label>
                <input id="add-url" [(ngModel)]="newApp.url" name="add-url" type="text"
                    (ngModelChange)="clearFieldError('url')"
                    [placeholder]="translocoService.translate('app_type.url_placeholder')"
                    class="mt-1 p-2 block w-full border-gray-300 rounded-md shadow-sm focus:ring-primary focus:border-primary">
                <span *ngIf="errorFields['url']" class="text-xs text-red-500 block mt-1">
                    {{ translocoService.translate(errorFields['url']) }}
                </span>
            </div>
            <div class="mb-4">
                <label for="title" class="block text-sm font-medium text-gray-700">Logo</label>
                <div class="flex gap-2">
                    <input id="title" [(ngModel)]="newApp.logo" name="logo" type="text"
                        [placeholder]="translocoService.translate('app_type.logo_placeholder')"
                        class="mt-1 p-2 block w-full border-gray-300 rounded-md shadow-sm focus:ring-primary focus:border-primary">
                    <input type="file" accept="image/*" (change)="onFileSelected($event)" class="hidden" #fileInput>
                    <button type="button" (click)="fileInput.click()"
                        class="mt-1 px-4 py-2 bg-primary text-white rounded-md">
                        <span class="material-icons">upload</span>
                    </button>
                </div>
                <div *ngIf="newApp.logo" class="mt-2">
                    <div class="relative w-full h-48 bg-gray-100 rounded-md overflow-hidden">
                        <img [src]="newApp.logo" alt="Logo preview" class="w-full h-full object-cover"
                            (error)="handleImageError($event)" (load)="handleImageLoad($event)">
                        <div *ngIf="isImageLoading"
                            class="absolute inset-0 flex items-center justify-center bg-gray-100">
                            <span class="material-icons animate-spin">refresh</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="mb-4">
                <label for="add-title" class="block text-sm font-medium text-gray-700">{{
                    translocoService.translate('app_type.industry') | titlecase}}<span
                        class="text-red-500">*</span></label>
                <div class="relative w-full" #dropdownRef>
                    <!-- Dropdown Trigger -->
                    <button type="button"
                        class="w-full border-gray-300 rounded-md shadow-sm p-2 cursor-pointer flex items-center justify-between break-words whitespace-normal gap-1"
                        (click)="toggleDropdown(newApp.id)"
                        [attr.aria-expanded]="isDropdownOpen(newApp.id)" aria-haspopup="true">
                        <span *ngIf="newApp.industry">
                            {{ translocoService.translate("app_type." + getIndustry(newApp.industry, "name")) }}
                        </span>
                        <span *ngIf="!newApp.industry">
                            {{ translocoService.translate("app_type.select_industry") }}
                        </span>
                        <svg class="w-4 h-4 ml-1 transition-transform"
                            [class.rotate-180]="isDropdownOpen(newApp.id)" fill="none"
                            stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M19 9l-7 7-7-7"></path>
                        </svg>
                    </button>
                    <!-- Dropdown Menu -->
                    <div *ngIf="isDropdownOpen(newApp.id)"
                        class="absolute top-full left-0 mt-1 bg-white border border-gray-200 rounded-lg shadow-lg z-50 min-w-full">
                        <div class="py-1">
                            <button *ngFor="let industry of industryOptions" type="button"
                                class="w-full px-3 py-2 text-left hover:bg-gray-100 flex items-center gap-2 transition-colors"
                                [class.text-primary]="industry.id === newApp.industry"
                                (click)="changeIndustry(newApp, industry.id)">
                                {{ translocoService.translate("app_type." + getIndustry(industry.id,
                                "name")) }}
                                <span style="font-size: 1rem;" class="text-primary"
                                    *ngIf="industry.id === newApp.industry"
                                    class="material-icons">check</span>
                            </button>
                        </div>
                    </div>
                </div>
                <span *ngIf="errorFields['industry'] && !newApp.industry" class="text-xs text-red-500 block mt-1">
                    {{ translocoService.translate(errorFields['industry']) }}
                </span>
            </div>
            <div class="flex justify-end gap-2">
                <button type="button" (click)="closeAddAppPopup()"
                    class="px-4 py-2 bg-red-50 text-red-500 font-semibold rounded-md">{{
                    translocoService.translate('app_type.btn_cancel') | titlecase}}</button>
                <button type="submit" class="px-4 py-2 bg-primary text-white font-semibold rounded-md">{{
                    translocoService.translate('app_type.btn_create') | titlecase}}</button>
            </div>
        </form>
    </div>
</div>
<div *ngIf="showUpdateAppPopup" class="fixed inset-0 bg-gray-800 bg-opacity-50 flex flex-col items-center justify-center z-50">
    <div class="flex items-center justify-between pr-4 pl-6 w-[400px] bg-primary text-on-primary rounded-t-lg">
        <div class="text-lg font-medium leading-10 my-2">
        {{ translocoService.translate('app_type.update') | titlecase }}
        </div>
        <span class="material-icons text-white cursor-pointer" (click)="closeUpdateAppPopup()">close</span>
    </div>
    <div class="bg-white rounded-b-lg shadow-lg p-6 w-[400px] max-h-[80vh] overflow-y-auto">
        <form (ngSubmit)="submitUpdateApp()">
            <div class="mb-4">
                <label for="update-title" class="block text-sm font-medium text-gray-700">{{
                    translocoService.translate('app_type.title_field') | titlecase}}<span
                        class="text-red-500">*</span></label>
                <input id="update-title" [(ngModel)]="newApp.title" name="update-title" type="text"
                    (ngModelChange)="clearFieldError('title')"
                    class="mt-1 p-2 block w-full border-gray-300 rounded-md shadow-sm focus:ring-primary focus:border-primary">
                <span *ngIf="errorFields['title']" class="text-xs text-red-500 block mt-1">
                    {{ translocoService.translate(errorFields['title']) }}
                </span>
            </div>
            <div class="mb-4">
                <label for="update-describe" class="block text-sm font-medium text-gray-700">{{
                    translocoService.translate('app_type.describe') }}</label>
                <input id="update-describe" [(ngModel)]="newApp.describe" name="update-describe" type="text"
                    (ngModelChange)="clearFieldError('describe')"
                    class="mt-1 p-2 block w-full border-gray-300 rounded-md shadow-sm focus:ring-primary focus:border-primary">
            </div>
            <div class="mb-4">
                <label for="update-url" class="block text-sm font-medium text-gray-700">URL<span
                        class="text-red-500">*</span></label>
                <input id="update-url" [(ngModel)]="newApp.url" name="update-url" type="text"
                    (ngModelChange)="clearFieldError('url')"
                    [placeholder]="translocoService.translate('app_type.url_placeholder')"
                    class="mt-1 p-2 block w-full border-gray-300 rounded-md shadow-sm focus:ring-primary focus:border-primary">
                <span *ngIf="errorFields['url']" class="text-xs text-red-500 block mt-1">
                    {{ translocoService.translate(errorFields['url']) }}
                </span>
            </div>
            <div class="mb-4">
                <label for="title" class="block text-sm font-medium text-gray-700">Logo</label>
                <div class="flex gap-2">
                    <input id="title" [(ngModel)]="newApp.logo" name="logo" type="text"
                        class="mt-1 p-2 block w-full border-gray-300 rounded-md shadow-sm focus:ring-primary focus:border-primary">
                    <input type="file" accept="image/*" (change)="onFileSelected($event)" class="hidden" #fileInput>
                    <button type="button" (click)="fileInput.click()"
                        class="mt-1 px-4 py-2 bg-primary text-white rounded-md">
                        <span class="material-icons">upload</span>
                    </button>
                </div>
                <div *ngIf="newApp.logo" class="mt-2">
                    <div class="relative w-full h-48 bg-gray-100 rounded-md overflow-hidden">
                        <img [src]="newApp.logo" alt="Logo preview" class="w-full h-full object-cover"
                            (error)="handleImageError($event)" (load)="handleImageLoad($event)">
                        <div *ngIf="isImageLoading"
                            class="absolute inset-0 flex items-center justify-center bg-gray-100">
                            <span class="material-icons animate-spin">refresh</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="mb-4">
                <label for="add-title" class="block text-sm font-medium text-gray-700">
                    {{ translocoService.translate('app_type.industry') | titlecase}}
                    <span class="text-red-500">*</span>
                </label>
                <div class="relative w-full" #dropdownRef>
                    <!-- Dropdown Trigger -->
                    <button type="button"
                        class="w-full border-gray-300 rounded-md shadow-sm p-2 cursor-pointer flex items-center justify-between break-words whitespace-normal gap-1"
                        
                        (click)="toggleDropdown(newApp.id)"
                        [attr.aria-expanded]="isDropdownOpen(newApp.id)" aria-haspopup="true">
                        {{ translocoService.translate("app_type." + getIndustry(newApp.industry, "name")) }}
                        <svg class="w-4 h-4 ml-1 transition-transform"
                            [class.rotate-180]="isDropdownOpen(newApp.id)" fill="none"
                            stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M19 9l-7 7-7-7"></path>
                        </svg>
                    </button>
                    <!-- Dropdown Menu -->
                    <div *ngIf="isDropdownOpen(newApp.id)"
                        class="absolute top-full left-0 mt-1 bg-white border border-gray-200 rounded-lg shadow-lg z-50 min-w-full">
                        <div class="py-1">
                            <button *ngFor="let industry of industryOptions" type="button"
                                class="w-full px-3 py-2 text-left hover:bg-gray-100 flex items-center gap-2 transition-colors"
                                [class.text-primary]="industry.id === newApp.industry"
                                (click)="changeIndustry(newApp, industry.id)">
                                {{ translocoService.translate("app_type." + getIndustry(industry.id, "name")) }}
                                <span style="font-size: 1rem;" class="text-primary"
                                    *ngIf="industry.id === newApp.industry"
                                    class="material-icons">check</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="flex justify-end gap-2">
                <button type="button" (click)="closeUpdateAppPopup()"
                    class="px-4 py-2 bg-red-50 text-red-500 font-semibold rounded-md">{{
                    translocoService.translate('app_type.btn_cancel') | titlecase}}</button>
                <button type="submit" class="px-4 py-2 bg-primary text-white font-semibold rounded-md">{{
                    translocoService.translate('app_type.btn_update') | titlecase}}</button>
            </div>
        </form>
    </div>
</div>
<div *ngIf="showDeletePopup" class="fixed inset-0 bg-gray-800 bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-white rounded-lg shadow-lg p-6 w-[400px]">
        <h2 class="text-lg font-semibold mb-4">{{ translocoService.translate('app_type.btn_delete') | titlecase}}
        </h2>
        <p class="text-gray-700 mb-4">{{ translocoService.translate('app_type.delete_message') | titlecase}}</p>
        <div class="flex justify-end gap-2" (click)="deleteApp()">
            <button type="button" (click)="closeDeletePopup()" class="px-4 py-2 bg-gray-300 text-gray-700 rounded-md">{{
                translocoService.translate('app_type.btn_cancel') | titlecase}}</button>
            <button type="submit" class="px-4 py-2 bg-red-500 text-white rounded-md">{{
                translocoService.translate('app_type.btn_delete') | titlecase}}</button>
        </div>
    </div>
</div>
<div *ngIf="showDeleteAllPopup" class="fixed inset-0 bg-gray-800 bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-white rounded-lg shadow-lg p-6 w-[400px]">
        <h2 class="text-lg font-semibold mb-4">
            {{ translocoService.translate("app_type.btn_delete") | titlecase }}
        </h2>
        <p class="text-gray-700 mb-4">
            {{ translocoService.translate("app_type.delete_message") | titlecase }}
        </p>
        <div class="flex justify-end gap-2" (click)="deleteAllApps()">
            <button type="button" (click)="closeDeleteAllPopup()"
                class="px-4 py-2 bg-gray-300 text-gray-700 rounded-md">
                {{ translocoService.translate("app_type.btn_cancel") | titlecase }}
            </button>
            <button type="submit" class="px-4 py-2 bg-red-500 text-white rounded-md">
                {{ translocoService.translate("app_type.btn_delete") | titlecase }}
            </button>
        </div>
    </div>
</div>