<div class="absolute inset-0 flex-col overflow-y-auto px-4 py-6 max-w-full"*transloco="let t" >
    <!-- Thống kê tổng hợp -->
    <div class="grid grid-cols-1 mb-8 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4">
         <app-card-dashboard
                [title]= "t('dashboard.totalUsersDesc')"
                [description]= "t('dashboard.totalUsersDesc')"
                [value]= "totalUsers"
                iconPath="groups"
                bgColor="bg-primary-700"
        ></app-card-dashboard>
        <app-card-dashboard
                [title]= "t('dashboard.totalAppsDesc') "
                [description]=" t('dashboard.totalAppsDesc') "
                [value]= "totalApp"
                iconPath= "smartphone"
                bgColor= "bg-primary-700"
        ></app-card-dashboard>
        <app-card-dashboard
                [title]= "t('dashboard.totalNewsDesc') "
                [description]=" t('dashboard.totalNewsDesc') "
                [value]= "totalNews"
                iconPath="newspaper"
                bgColor="bg-primary-700"
        ></app-card-dashboard>
        <app-card-dashboard
                [title]=" t('dashboard.totalProductsDesc') "
                [description]="t('dashboard.totalProductsDesc') "
                [value]="totalProducts"
                iconPath="shopping_cart"
                bgColor="bg-primary-700"
        ></app-card-dashboard>
        <app-card-dashboard
                [title]=" t('dashboard.totalMessagesDesc') "
                [description]=" t('dashboard.totalMessagesDesc') "
                [value]= "totalMessages"
                iconPath="chat"
                bgColor="bg-primary-700"
        ></app-card-dashboard>
    </div>
    <!-- Grid nội dung chính -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 w-full">
        <!-- Chart và thống kê -->
        <div class="lg:col-span-2 grid grid-cols-1 md:grid-cols-2 gap-6 w-full">
            <!-- Line chart traffic -->
            <div class="bg-white rounded-lg shadow p-4 col-span-1 md:col-span-2 w-full overflow-x-auto">
                <div class="font-bold pb-2">{{t('dashboard.traffic') }}</div>
                <div class="relative w-full min-w-[320px] aspect-[5/1]" *ngIf="lineChartData.datasets[0].data.length && maxLineChartValue > 0">
                    <!-- Y-axis labels -->
                    <div class="absolute left-0 -top-1 bottom-0 flex flex-col justify-between text-xs text-gray-500 z-10 pl-1 pb-6">
                        <span *ngFor="let y of salesChartYAxis">{{ y }}</span>
                    </div>
                    <svg viewBox="0 0 500 100" class="w-full h-full ml-8">
                        <!-- Định nghĩa gradient -->
                        <defs>
                            <!-- Gradient cho LINE (đường kẻ) -->
                            <linearGradient id="line-gradient" x1="0" y1="0" x2="0" y2="1">
                                <stop offset="0%" stop-color="#2b67fb" />
                                <stop offset="100%" stop-color="#1a4ddb" />
                            </linearGradient>

                            <!-- Gradient cho AREA (phần nền dưới line) -->
                            <linearGradient id="area-gradient" x1="0" y1="0" x2="0" y2="1">
                                <stop offset="0%" stop-color="#5d8bfc" stop-opacity="0.30"/>
                                <stop offset="100%" stop-color="#5d8bfc" stop-opacity="0"/>
                            </linearGradient>

                             <!-- Hiệu ứng đổ bóng cho line -->
                            <filter id="line-shadow" x="-20%" y="-20%" width="140%" height="140%">
                                <feDropShadow dx="0" dy="2" stdDeviation="2" flood-color="#5d8bfc" flood-opacity="0.15"/>
                            </filter>
                        </defs>
                        <!-- Vùng area fill -->
                         
                        <path [attr.d]="getAreaPath(lineChartData.datasets[0].data, chartWidth, chartHeight, chartPadding)"
                            fill="url(#area-gradient)" 
                            stroke="none"
                            />
                        <!-- Đường line -->
                        <path [attr.d]="getStraightLinePath(lineChartData.datasets[0].data, chartWidth, chartHeight, chartPadding)"
                            fill="url(#area-gradient)"  
                            stroke-width="1.2"
                            stroke="#3941AB"/>
                        <!-- Lưới ngang -->
                        <g *ngIf="maxLineChartValue > 0">
                            <line *ngFor="let y of salesChartYAxis"
                                [attr.y1]="100 - (y / maxLineChartValue * 100)"
                                [attr.y2]="100 - (y / maxLineChartValue * 100)"
                                x1="0" x2="484"
                                stroke="#d0d5dd" stroke-width="0.8px" opacity="0.8" stroke-dasharray="3 2"/>
                        </g>
                        <!-- Các đỉnh (chấm tròn) -->
                        <g *ngIf="lineChartData.datasets[0].data.length && maxLineChartValue > 0">
                            <ng-container *ngFor="let value of lineChartData.datasets[0].data; let i = index">
                                <circle
                                    [attr.cx]="getXByMonth(i)"
                                    [attr.cy]="getY(value)"
                                    [attr.r]="hoveredLineIndex === i ? 1.4 : 1.2"
                                    fill="#3941AB"
                                    stroke="#3941AB"
                                    stroke-width="2"
                                    [attr.opacity]="hoveredLineIndex === i ? 1 : 0.95"
                                    style="cursor:pointer; transition: all 0.2s"
                                    (mouseenter)="hoveredLineIndex = i"
                                    (mouseleave)="hoveredLineIndex = null"
                                    filter="url(#line-shadow)"
                                />
                                <!-- Tooltip số lượng -->
                                <g *ngIf="hoveredLineIndex === i">
                                    <rect
                                        [attr.x]="getTooltipX(i)"
                                        [attr.y]="getTooltipY(value)"
                                        width="36"
                                        height="18"
                                        rx="6"
                                        fill="#fff"
                                        stroke="#3941AB"
                                        stroke-width="1.5"
                                        opacity="0.98"
                                        filter="url(#line-shadow)"
                                    />
                                    <text
                                        [attr.x]="getTooltipX(i) + rectWidth / 2"
                                        [attr.y]="getTooltipY(value) + rectHeight / 2 + 1"
                                        text-anchor="middle"
                                        class="text-xs font-bold"
                                        fill="#3941AB"
                                    >
                                        {{ value }}
                                    </text>
                                </g>
                            </ng-container>
                        </g>
                    </svg>
                    <div class="flex justify-between text-xs text-gray-500 mt-4 pl-9yy translate-x-4 ">
                        <span *ngFor="let label of lineChartData.labels">{{ label }}</span>
                    </div>
                </div>
            </div>
            <!-- Bar chart sản phẩm -->
            <div class="bg-white rounded-lg shadow-sm p-6 h-full w-full overflow-x-auto">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="font-bold text-black">{{t('dashboard.productsByCategory') }}</h3>
                </div>

                <hr class="border-t border-gray-300 opacity-50 my-4 mb-9" />

                <!-- Bar Chart -->
                <div class="relative h-64 min-w-[320px]">
                    <!-- Y-axis labels -->
                    <div class="absolute left-0 -top-5 h-full flex flex-col justify-between text-xs text-gray-500">
                        <span *ngFor="let label of salesChartYAxis">{{ label }}</span>
                    </div>

                    <!-- Chart area -->
                    <div class="ml-8 h-full flex items-end justify-around">
                        <!-- Horizontal grid lines -->
                        <div class="absolute inset-0 ml-8 flex flex-col justify-between">
                            <div class="border-b border-dashed border-gray-200 h-0" *ngFor="let _ of salesChartYAxisBars">
                            </div>
                        </div>

                        <!-- Bars -->
                        <div *ngFor="let bar of salesChartData; let i = index"
                            class="w-10 relative flex flex-col items-center group transition-all duration-200"
                            [ngStyle]="{
                                'background': hoveredBarIndex === i
                                    ? 'linear-gradient(180deg, #0448ef 0%, #4479fc 100%)'
                                    : 'linear-gradient(180deg, #5d8bfc 0%, #2b67fb 100%)',
                                'boxShadow': hoveredBarIndex === i ? '0 4px 16px 0 rgba(59,130,246,0.15)' : 'none',
                                'transform': hoveredBarIndex === i ? 'scale(1.07)' : 'scale(1)'
                            }"
                            [style.height.%]="bar.percentage"
                            style="cursor: pointer;"
                            (mouseenter)="hoveredBarIndex = i" (mouseleave)="hoveredBarIndex = null">

                            <!-- Tooltip -->
                            <div *ngIf="hoveredBarIndex === i"
                                class="absolute -top-8 left-1/2 -translate-x-1/2 bg-white text-primary text-xs px-3 py-1 rounded shadow font-bold z-20 border border-blue-200">
                                {{ bar.value }}
                            </div>

                            <!-- Giá trị dưới bar -->
                            <div class="w-10 text-xs text-center text-white mt-2 font-semibold select-none">
                                {{ bar.name }}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Doughnut chart truy cập ứng dụng -->
            <div class="bg-white rounded-lg shadow p-6 w-full"> 
                <div class="flex justify-between items-center mb-6">
                    <h3 class="font-bold text-black">{{ t('dashboard.appAccess') }}</h3>
                </div>
                <div class="relative w-50 h-50 mx-auto my-5">
                    <svg viewBox="0 0 36 36" class="w-full h-full">
                        <ng-container *ngFor="let item of doughnutChartData; let i = index">
                            <!-- Path ẩn để bắt hover -->
                            <path
                            [attr.d]="getDoughnutArcPath(i)"
                            [attr.stroke]="item.color"
                            [attr.stroke-width]="hoveredDoughnutIndex === i ? 12 : 8"
                            fill="none"
                            style="cursor:pointer; transition: stroke-width 0.2s;"
                            (mouseenter)="hoveredDoughnutIndex = i"
                            (mouseleave)="hoveredDoughnutIndex = null"
                          />
                          

                        </ng-container>
                        <!-- Vòng trắng ở giữa -->
                        <circle cx="18" cy="18" r="5" fill="#fff" />
                    </svg>
                    <div class="absolute inset-0 flex items-center justify-center" style="pointer-events: none;">
                        <ng-container *ngIf="hoveredDoughnutIndex !== null; else showTotal">
                            <div class="flex flex-col items-center">
                                <span class="text-xl font-bold"
                                    [style.color]="doughnutChartData[hoveredDoughnutIndex].color">
                                    {{ doughnutChartData[hoveredDoughnutIndex].value }}
                                </span>
                                <span class="text-xs text-gray-500">
                                    {{ ((doughnutChartData[hoveredDoughnutIndex].value / doughnutTotal) * 75.4) |
                                    number:'1.0-1' }}%
                                </span>
                            </div>
                        </ng-container>
                        <ng-template #showTotal>
                            <span class="text-2xl font-bold text-blue-700">{{ doughnutTotal }}</span>
                        </ng-template>
                    </div>
                </div>
                <div class="flex justify-center mt-2 space-x-4 text-xs">
                    <div *ngFor="let item of doughnutChartData; let i = index" class="flex items-center">
                        <span class="inline-block w-3 h-3 rounded-full mr-1" [style.background]="item.color"></span>
                        {{ item.name }}

                    </div>
                </div>
            </div>
        </div>
        <!-- Hoạt động gần đây và đăng ký mới -->
        <div class="flex flex-col gap-6 w-full">
            <!-- Hoạt động gần đây và đăng ký mới -->
            <div class="flex flex-col gap-6 w-full">
              <div class="bg-white rounded-lg shadow p-4 w-full">
                <div class="font-bold mb-2">{{ t('dashboard.recentActivities') }}</div>
                <ul class="space-y-2">
                  <!-- User registered -->
                  <li *ngFor="let user of recentUsers | slice:0:1" class="flex items-center justify-between">
                    <div class="flex items-center gap-2 flex-1 min-w-0">
                      <span class="material-icons text-primary">person</span>
                      <span class="truncate">
                        {{ t('dashboard.activity.userRegistered', { name: user.username }) }}
                      </span>
                    </div>
                    <span class="w-20 text-right text-xs text-gray-400 whitespace-nowrap">
                      {{ timeAgo(user.created_at) }}
                    </span>
                  </li>
              
                  <!-- New message -->
                  <li class="flex items-center justify-between">
                    <div class="flex items-center gap-2 flex-1 min-w-0">
                      <span class="material-icons text-primary">chat</span>
                      <span class="truncate">
                        {{ t('dashboard.newMessages') }}
                      </span>
                    </div>
                    <span class="w-20 text-right text-xs text-gray-400 whitespace-nowrap">
                      {{ t('time.1DayAgo') }}
                    </span>
                  </li>
              
                  <!-- New product -->
                  <li class="flex items-center justify-between">
                    <div class="flex items-center gap-2 flex-1 min-w-0">
                      <span class="material-icons text-primary">add_shopping_cart</span>
                      <span class="truncate">
                        {{ t('dashboard.product_add_market') }}
                      </span>
                    </div>
                    <span class="w-20 text-right text-xs text-gray-400 whitespace-nowrap">
                      {{ t('time.1DayAgo') }}
                    </span>
                  </li>
                </ul>
              </div>
            </div>

            <div class="bg-white rounded-lg shadow p-4 w-full">
              <div class="font-bold mb-2">{{ t('dashboard.recentRegistrations') }}</div>
              <ul class="space-y-2">
                <li *ngFor="let user of recentUsers" class="flex items-center justify-between">
                  <!-- Icon + text -->
                  <div class="flex items-center gap-2">
                    <span class="material-icons text-primary">person</span>
                    <span class="text-sm">
                      {{ t('dashboard.activity.userRegistered', { name: user.username }) }}
                    </span>
                  </div>
              
                  <!-- Time -->
                  <span class="w-20 text-right text-xs text-gray-400 whitespace-nowrap">
                    {{ timeAgo(user.created_at) }}
                  </span>
                </li>
              </ul>
            </div>

            <div class="bg-white rounded-lg shadow p-4 w-full">
                <div class="font-bold mb-2">{{ t('dashboard.topLikedPosts') }}</div>
                <div *ngFor="let post of numberOfLike " class="flex gap-4 mb-4 last:mb-0">
                    <img [src]="post.images__image || 'assets/images/logo/logo.png'" alt="Ảnh bài viết" class="w-20 h-20 rounded object-cover" />
                    
                    <div class="flex-1">
                      <h4 class="text-sm font-semibold text-black mb-1 overflow-hidden text-ellipsis line-clamp-3" >
                        {{ post.content }}
                      </h4>
                      <p class="text-xs text-gray-500 mb-1 line-clamp-2">
                        {{ post.category }}
                      </p>
                      <div class="flex items-start justify-between text-xs text-gray-400 mt-1">
                        <span>
                          <i class="material-icons text-xs align-middle mr-1">person</i>{{ post.created_by__full_name || post.created_by__username }}
                        </span>
                        <span>
                          <i class="material-icons text-xs align-middle mr-1">favorite</i>{{ post.like_account }} lượt thích
                        </span>
                      </div>
                    </div>
            </div>
              
        </div>
    </div>
</div>