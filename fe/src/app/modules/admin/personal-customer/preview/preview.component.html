<div class="absolute inset-0 flex flex-col items-center justify-start bg-white px-4 py-2 z-40 overflow-hidden overflow-y-auto"
    *ngIf="showPreview" @fadeInOut (@fadeInOut.done)="onAnimationDone($event)">

    <!-- Header Bar -->
    <div class="w-full flex items-center justify-between py-3 px-5 border-b bg-white sticky top-0 z-10">

        <!-- Title bên trái -->
        <div class="text-xl font-semibold text-gray-800">
            Preview
        </div>

        <!-- Các nút size ở giữa -->
        <!-- <div class="flex space-x-2 justify-center flex-1">
            <button *ngFor="let size of getVisibleSizes()" (click)="changePopupSize(size.class)" [ngClass]="{
                        'border-primary border-2': popupSize === size.class,
                        'border': popupSize !== size.class
                    }" class="px-4 py-2 rounded-lg flex items-center space-x-1 hover:bg-gray-100 transition text-sm">
                <mat-icon>{{ size.icon }}</mat-icon>
                <span>{{ size.label }}</span>
            </button>
        </div> -->

        <!-- Nút đóng bên phải -->
        <mat-icon (click)="onClose()" class="cursor-pointer">close</mat-icon>
    </div>

    <!-- Content Wrapper -->
    <div class="flex justify-center w-full py-4 flex-1 overflow-hidden">
        <div [ngClass]="popupSize" [class.mx-auto]="popupSize !== 'w-full'"
            class="h-full max-h-[calc(100vh-64px)] border overflow-y-auto p-4 bg-white rounded-xl shadow-xl">
            <!-- Hiển thị popup -->
            <div *ngIf="formJson?.length > 0; else noData">
                <div *ngFor="let section of formJson" class="rounded-lg mb-4 p-2 relative">

                    <!-- Section title -->
                    <div class="w-full bg-blue-100 mb-3 py-3 pl-2 text-lg font-semibold">
                        <h3>{{ section.title }}</h3>
                    </div>

                    <!-- Grid layout cho inputs -->
                    <div [ngClass]="{
                        'grid-cols-1': popupSize === 'w-[375px]' || popupSize === 'w-[844px]' || popupSize === 'w-[850px]',
                        'grid-cols-2': popupSize === 'w-[1280px]' || popupSize === 'w-full'
                    }" class="grid gap-x-8 gap-y-3">

                        <div *ngFor="let field of section.fields"
                            [ngClass]="popupSize === 'w-[375px]' ? 'flex flex-col items-start space-y-2' : 'flex md:flex-row items-center'"
                            class="rounded-lg relative px-3">

                            <mat-form-field
                                *ngIf="['text', 'number', 'email', 'password', 'datetime-local'].includes(field.type)"
                                floatLabel="always" class="w-full fuse-mat-dense">
                                <mat-label>{{ field.label }}</mat-label>
                                <input matInput [type]="field.type" [name]="field.name"
                                    [placeholder]="field.placeholder" [required]="field.config?.required"
                                    class="h-full" readonly />
                            </mat-form-field>

                            <mat-form-field *ngIf="field.type === 'date'" floatLabel="always" class="w-full fuse-mat-dense">
                                <mat-label>{{ field.label }}</mat-label>
                                <input matInput type="text" [name]="field.name"
                                    placeholder="dd/mm/yyyy" [required]="field.config?.required"
                                    class="h-full" readonly/>
                            </mat-form-field>

                            <mat-form-field *ngIf="field.type === 'select'" floatLabel="always"
                                class="w-full fuse-mat-dense">
                                <mat-label>{{ field.label }}</mat-label>
                                <mat-select [name]="field.name" [placeholder]="field.placeholder"
                                    [required]="field.config?.required" readonly>
                                    <mat-option *ngFor="let option of field.select_options" [value]="option.id">
                                        {{ option.name }}
                                    </mat-option>
                                </mat-select>
                                <span mat-icon-button matSuffix disableRipple class="custom-icon">
                                    <mat-icon>expand_more</mat-icon>
                                </span>
                            </mat-form-field>

                            <!-- Textarea -->
                            <mat-form-field *ngIf="field.type === 'textarea'" floatLabel="always"
                                class="w-full fuse-mat-dense">
                                <mat-label>{{ field.label }}</mat-label>
                                <textarea matInput [name]="field.name" [placeholder]="field.placeholder"
                                    [required]="field.config?.required" rows="1" readonly></textarea>
                            </mat-form-field>

                            <!-- File Upload -->
                            <div *ngIf="field.type === 'file'" class="w-full">
                                <label class="block font-semibold text-base">
                                    {{ field.label }} <span *ngIf="field.config?.required" class="text-red-500">*</span>
                                </label>
                                <input [type]="field.type" [name]="field.name" [placeholder]="field.placeholder"
                                    [required]="field.config?.required" [attr.accept]="field.config?.accept"
                                    disabled readonly
                                    class="block w-full file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-primary-100 file:text-primary-700 hover:file:bg-primary-200" />
                            </div>

                        </div>

                    </div>
                </div>
            </div>

            <ng-template #noData>
                <p>Không có dữ liệu để hiển thị.</p>
            </ng-template>

        </div>
    </div>
</div>