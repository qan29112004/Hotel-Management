<div *ngIf="showEditOverlay" class="absolute inset-0 z-10 flex w-full h-full bg-white bg-opacity-70">
    <div class="relative w-full h-full bg-white">
        <button (click)="closeEditOverlay()" class="absolute top-3 right-3 z-[1000] w-10 h-10 rounded-full bg-gray-800/70 text-white flex items-center justify-center">
            <span class="material-icons">close</span>
        </button>
        <app-user-infor-edit class="block w-full h-full"></app-user-infor-edit>
    </div>
    
</div>

<div
    *transloco="let t"
    class="flex flex-col items-center w-full h-full min-w-0 sm:pt-3"
    fuseScrollbar
>
    <div class="flex flex-col sm:w-[75%] sm:max-w-[75%] max-sm:w-full gap-8">
        <div class="flex w-full h-auto rounded-lg ring-2 ring-gray-200/50">
            <div class="flex flex-col w-full gap-4 px-6 py-4">
                <div class="flex items-center justify-between max-sm:items-start max-md:flex-col max-md:gap-3">
                    <div class="flex items-center gap-4 max-sm:items-start max-sm:flex-col max-sm:gap-3">
                        <div class="w-40 h-40 border border-gray-300 rounded-full aspect-square">
                            <img class="object-cover rounded-full aspect-square" [src]="currentUser?.avatar || 'assets/images/avatars/default-avatar.svg'"/>
                        </div>
                        <div class="flex flex-col gap-2">
                            <span class="text-[28px] font-lexend_deca text-[#333333] font-semibold">{{currentUser.fullName || currentUser.username}}</span>
                            <span class="text-[20px] text-[#9E9E9E] font-lexend_deca font-medium">{{news.length}} {{"user_infor.posts" | transloco}}</span>
                        </div>
                    </div>
                    <button type='button' (click)="openEditOverlay()" class="flex items-center max-sm:w-full w-auto h-auto justify-center bg-[#3941AB] py-3 px-8 gap-2 rounded-md">
                        <div class="text-xl text-white material-icons">border_color</div>
                        <span class="text-xl font-semibold text-white font-lexend_deca">{{"user_infor.edit_profile" | transloco}}</span>
                    </button>
                </div>
                <div class="grid grid-cols-4 max-md:grid-cols-2 max-md:gap-x-3 max-md:gap-y-3">
                    <button type='button' class="flex items-center justify-center py-3 text-[14px] font-lexend_deca font-semibold hover:text-[#4752E1] hover:border-b hover:border-[#4752E1]">{{"user_infor.overview" | transloco}}</button>
                    <button type='button' class="flex items-center justify-center py-3 text-[14px] font-lexend_deca font-semibold hover:text-[#4752E1] hover:border-b hover:border-[#4752E1]">{{"user_infor.news_feed" | transloco}}</button>
                    <button type='button' class="flex items-center justify-center py-3 text-[14px] font-lexend_deca font-semibold hover:text-[#4752E1] hover:border-b hover:border-[#4752E1]">{{"user_infor.details" | transloco}}</button>
                    <button type='button' class="flex items-center justify-center py-3 text-[14px] font-lexend_deca font-semibold hover:text-[#4752E1] hover:border-b hover:border-[#4752E1]">{{"user_infor.photos" | transloco}}</button>
                </div>
            </div>
        </div>
        <div class="flex w-full h-auto gap-6 max-md:flex-col">
            <div class="flex flex-col gap-6 w-[30%] max-w-[30%] max-md:w-full max-md:max-w-full">
                <div class="flex flex-col w-full h-auto gap-6 p-4 rounded-lg ring-2 ring-gray-200/50">
                    <div class="text-3xl font-semibold font-lexend_deca">{{"user_infor.details" | transloco}}</div>
                    <div class="grid grid-cols-2">
                        <div class="flex flex-col gap-3">
                            <span class="font-medium font-lexend_deca">{{"user_infor.account_name" | transloco}}</span>
                            <span class="font-medium font-lexend_deca">{{"user_infor.full_name" | transloco}}</span>
                            <span class="font-medium font-lexend_deca">{{"user_infor.phone_number" | transloco}}</span>
                            <span class="font-medium font-lexend_deca">{{"user_infor.email" | transloco}}</span>
                            <span class="font-medium font-lexend_deca">{{"user_infor.address" | transloco}}</span>
                            <span class="font-medium font-lexend_deca">{{"user_infor.gender" | transloco}}</span>
                            <span class="font-medium font-lexend_deca">{{"user_infor.birthday" | transloco}}</span>
                        </div>
                        <div class="relative flex flex-col gap-3">
                            <div class="relative">
                                <span [class.hidden]="tooltipUsername" class="absolute z-10 p-2 text-xs text-white bg-gray-800 rounded shadow-lg" style="top: -2.5rem; left: 0;">{{currentUser.username || 'user_infor.none' | transloco}}</span>
                                <span (click)="showTooltip('username')" title="{{currentUser.username || 'user_infor.none' | transloco}}" class="font-medium font-lexend_deca text-[#626262] truncate block">{{currentUser.username || 'user_infor.none' | transloco}}</span>
                            </div>
                            <div class="relative">
                                <span [class.hidden]="tooltipFullname" 
                                        class="absolute z-10 p-2 text-xs text-white bg-gray-800 rounded shadow-lg" 
                                        style="top: -2.5rem; left: 0;">
                                    {{ currentUser.fullname || ('user_infor.none' | transloco) }}
                                </span>
                                <span title="{{currentUser.fullname || 'user_infor.none' | transloco}}" (click)="showTooltip('fullname')" class="font-medium font-lexend_deca text-[#626262] truncate block">{{currentUser.fullname || 'user_infor.none' | transloco}}</span>
                            </div>
                            <div class="relative">
                                <span [class.hidden]="tooltipPhone" class="absolute z-10 p-2 text-xs text-white bg-gray-800 rounded shadow-lg" style="top: -2.5rem; left: 0;">{{currentUser.phone || 'user_infor.none' | transloco}}</span>
                                <span title="{{currentUser.phone || 'user_infor.none' | transloco}}" (click)="showTooltip('phone')" class="font-medium font-lexend_deca text-[#626262] truncate block">{{currentUser.phone || 'user_infor.none' | transloco}}</span>
                            </div>
                            <div class="relative">
                                <span [class.hidden]="tooltipEmail" class="absolute z-10 p-2 text-xs text-white bg-gray-800 rounded shadow-lg" style="top: -2.5rem; left: 0;">{{currentUser.email || 'user_infor.none' | transloco}}</span>
                                <span title="{{currentUser.email || 'user_infor.none' | transloco}}" (click)="showTooltip('email')" class="font-medium font-lexend_deca text-[#626262] truncate block">{{currentUser.email || 'user_infor.none' | transloco}}</span>
                            </div>
                            <div class="relative">
                                <span [class.hidden]="tooltipAddress" class="absolute z-10 p-2 text-xs text-white bg-gray-800 rounded shadow-lg" style="top: -2.5rem; left: 0;">{{currentUser.address || 'user_infor.none' | transloco}}</span>
                                <span title="{{currentUser.address || 'user_infor.none' | transloco}}" (click)="showTooltip('address')" class="font-medium font-lexend_deca text-[#626262] truncate block">{{currentUser.address || 'user_infor.none' | transloco}}</span>
                            </div>
                            <div class="relative">
                                <span [class.hidden]="tooltipGender" class="absolute z-10 p-2 text-xs text-white bg-gray-800 rounded shadow-lg" style="top: -2.5rem; left: 0;">{{currentUser.gender || 'user_infor.none' | transloco}}</span>
                                <span title="{{currentUser.gender || 'user_infor.none' | transloco}}" (click)="showTooltip('gender')" class="font-medium font-lexend_deca text-[#626262] truncate block">{{ currentUser.gender === 'male' ? ('user_infor.gender_male' | transloco) : (currentUser.gender === 'female' ? ('user_infor.gender_female' | transloco) : ('user_infor.none' | transloco)) }}</span>
                            </div>
                            <div class="relative">
                                <span [class.hidden]="tooltipBirthday" class="absolute z-10 p-2 text-xs text-white bg-gray-800 rounded shadow-lg" style="top: -2.5rem; left: 0;">{{currentUser.birthday || 'user_infor.none' | transloco}}</span>
                                <span title="{{currentUser.birthday || 'user_infor.none' | transloco}}" (click)="showTooltip('birthday')" class="font-medium font-lexend_deca text-[#626262] truncate block">{{currentUser.birthday || 'user_infor.none' | transloco}}</span>
                            </div>
                        </div>
                    </div>
                    <button type="button" disabled title="Đang phát triển" class="flex items-center justify-center border border-[#4752E1] bg-[#E0EAFF] p-2 rounded-md disabled:cursor-not-allowed disabled:opacity-50">
                        <span class="text-[14px] font-lexend_deca font-semibold">{{"user_infor.add_details" | transloco}}</span>
                    </button>
                    <button type='button' disabled title="Đang phát triển" class="flex items-center justify-center bg-[#3941AB] rounded-md p-2 disabled:cursor-not-allowed disabled:opacity-50">
                        <span class="text-[14px] font-lexend_deca font-semibold text-white">{{"user_infor.edit" | transloco}}</span>
                    </button>
                </div>
                <div class="flex flex-col w-full h-auto gap-6 p-4 rounded-lg ring-2 ring-gray-200/50">
                    <div class="flex items-center justify-between">
                        <span class="text-3xl font-semibold font-lexend_deca">{{"user_infor.photos" | transloco}}</span>
                        <button type="button" disabled title="Đang phát triển" class="text-[14px] font-lexend_deca text-[#11A0FF] disabled:cursor-not-allowed disabled:opacity-50">{{"user_infor.view_all_photos" | transloco}}</button>
                    </div>
                    <div class="grid grid-cols-3 gap-x-[2px] gap-y-[2px]">
                        <div class="overflow-hidden aspect-square">
                            <img src="assets/images/marketplace/image1.jpg" class="object-cover w-full h-full"/>
                        </div>
                        <div class="overflow-hidden aspect-square">
                            <img src="assets/images/marketplace/image2.jpg" class="object-cover w-full h-full"/>
                        </div>
                        <div class="overflow-hidden aspect-square">
                            <img src="assets/images/marketplace/image3.jpg" class="object-cover w-full h-full"/>
                        </div>
                        <div class="overflow-hidden aspect-square">
                            <img src="assets/images/marketplace/image4.jpg" class="object-cover w-full h-full"/>
                        </div>
                        <div class="overflow-hidden aspect-square">
                            <img src="assets/images/marketplace/image5.jpg" class="object-cover w-full h-full"/>
                        </div>
                        <div class="overflow-hidden aspect-square">
                            <img src="assets/images/marketplace/image6.jpg" class="object-cover w-full h-full"/>
                        </div>
                        
                    </div>
                </div>
            </div>
            <div class="w-[70%] max-w-[70%] max-md:w-full max-md:max-w-full h-full space-y-4">
                <!-- Khối đăng bài -->
                <div class="p-4 rounded-lg ring-2 ring-gray-200/50">
                    <div class="flex items-center gap-2 mb-3">
                        <img [src]="currentUser?.avatar || 'assets/images/avatars/default-avatar.svg'"
                            class="object-cover w-10 h-10 border border-gray-300 rounded-full" />
                        <input (click)="openCreateNewsPopup()" type="text" placeholder="{{ translocoService.translate('news-feed.post_placeholder') }}"
                            class="w-full px-2 py-2 text-sm" />
                    </div>
                    <div class="flex justify-between pt-2 text-sm border-t" (click)="openCreateNewsPopup()">
                        <button class="flex items-center justify-center w-1/3 gap-2 font-semibold">
                            <mat-icon class="text-blue-500" [svgIcon]="'heroicons_solid:pencil-square'"></mat-icon>
                            {{ translocoService.translate('news-feed.post') }}
                        </button>
                        <button class="flex items-center justify-center w-1/3 gap-2 font-semibold border-x-2"
                            (click)="openCreateNewsPopup()">
                            <mat-icon class="text-green-500" [svgIcon]="'heroicons_solid:photo'"></mat-icon>
                            {{ translocoService.translate('news-feed.image') }}
                        </button>
                        <button class="flex items-center justify-center w-1/3 gap-2 font-semibold"
                            (click)="openCreateNewsPopup()">
                            <span class="text-orange-500 material-icons">file_present</span>
                            File
                        </button>
                    </div>
                </div>

                <!-- Khối lọc category -->
                <div #categoryDropdownOutside
                    class="flex flex-row items-center justify-between py-2 rounded-lg ring-2 ring-gray-200/50 ps-4">
                    <span class="material-icons text-primary">sticky_note_2</span>
                    <div class="relative inline-block w-full">
                        <button (click)="showCategoryDropdown = !showCategoryDropdown"
                            class="flex items-center justify-between w-full gap-2 transition-colors rounded-lg h-9 ps-3 pe-4"
                            [class.border-blue-500]="selectedCategoryIds.length > 0" type="button">
                            <span class="flex flex-wrap items-center gap-1 text-sm text-gray-700">
                                <ng-container *ngIf="selectedCategoryIds.length === 0; else selectedList">
                                    <span class="font-semibold text-md">{{ translocoService.translate('news-feed.category') }}</span>
                                </ng-container>
                                <ng-template #selectedList>
                                    <ng-container *ngFor="let cat of selectedCategories">
                                        <span
                                            class="flex items-center gap-1 px-2 py-0.5 bg-gray-100 text-gray-800 rounded-md text-md"
                                            (click)="$event.stopPropagation()">
                                            {{ cat.name | titlecase }}
                                            <button type="button" class="text-gray-800 hover:text-red-600"
                                                (click)="removeCategory(cat.id); $event.stopPropagation();">
                                                ×
                                            </button>
                                        </span>
                                    </ng-container>
                                </ng-template>
                            </span>
                            <mat-icon class="text-sm text-gray-500"
                                [svgIcon]="'heroicons_outline:chevron-down'"></mat-icon>
                        </button>
                        <!-- Dropdown -->
                        <div *ngIf="showCategoryDropdown"
                            class="absolute left-0 z-50 w-full mt-1 rounded-lg shadow-lg top-full">
                            <div class="flex flex-row justify-between p-3 border-b border-gray-100">
                                <h3 class="text-sm font-medium text-gray-900">
                                    {{ translocoService.translate('news.category') }}
                                </h3>
                            </div>
                            <div class="overflow-y-auto max-h-30">
                                <label *ngFor="let cat of categories"
                                    class="flex items-center gap-3 px-3 py-2 cursor-pointer hover:bg-gray-50">
                                    <input type="checkbox" [checked]="selectedCategoryIds.includes(cat.id)"
                                        (change)="onCategoryFilterChange(cat.id, $event)"
                                        class="w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500" />
                                    <span class="flex items-center gap-2 text-sm text-gray-700">
                                        {{ cat.name }}
                                    </span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Danh sách bài viết -->
                <ng-container *ngFor="let post of news">
                    <div class="p-4 pb-4 rounded-lg ring-2 ring-gray-200/50">
                        <div class="flex items-center gap-3 mb-2">
                            <img [src]="post.createdBy?.avatar || 'assets/images/avatars/default-avatar.svg'"
                                class="object-cover w-10 h-10 rounded-full" />
                            <div>
                                <div class="text-sm font-semibold">{{ post.createdBy.fullName || post.createdBy.username
                                    }}</div>
                                <div class="text-xs text-gray-500">{{ post.createdAt | date:'dd/MM/yyyy HH:mm' }}</div>
                            </div>
                        </div>

                        <div *ngIf="post.categories?.length > 0" class="flex flex-wrap gap-2 mb-2">
                            <span *ngFor="let cat of post.categories"
                                class="px-2 py-1 text-xs text-gray-800 bg-gray-100 rounded">{{ cat.name | titlecase
                                }}</span>
                        </div>

                        <!-- Title -->
                        <!-- <h2 class="mb-2 text-base font-medium">{{ post.title }}</h2> -->
                        <!-- File (nếu có) -->
                        <div *ngIf="post.attachments?.length > 0" class="mb-2 space-y-2">
                            <div *ngFor="let att of post.attachments"
                                class="flex items-center justify-between p-2 bg-gray-100 rounded-md shadow-sm">
                                <div class="flex items-center gap-2">
                                    <!-- Icon file -->
                                    <span class="text-orange-500 material-icons">file_present</span>

                                    <!-- Link tải file -->
                                    <a [href]="att.file" [download]="att.filename"
                                        class="text-sm font-medium text-blue-600 hover:underline" target="_blank"
                                        rel="noopener noreferrer">
                                        {{ att.filename }}
                                    </a>
                                </div>
                            </div>
                        </div>


                        <!-- Nội dung không có ảnh -->
                        <div class="mb-2 text-sm text-gray-800 break-words whitespace-pre-line"
                            [ngClass]="{ 'line-clamp-3': !isExpanded(post.id) }">
                            {{ post.content }}
                        </div>
                        
                        <!-- Hiển thị nút nếu nội dung có vẻ dài (tuỳ ý, bạn có thể cải tiến sau khi tính toán độ dài) -->
                        <button
                            *ngIf="isClamped(post)"
                            class="mb-1 text-sm font-medium text-blue-600 hover:underline"
                            (click)="toggleExpand(post.id)">
                            {{ isExpanded(post.id) 
                                ? translocoService.translate('news-feed.hide') 
                                : translocoService.translate('news-feed.expand') }}
                        </button>

                        <!-- Layout ảnh -->
                        <ng-container *ngIf="post.images.length > 0">

                            <!-- 1 ảnh: full width -->
                            <div *ngIf="post.images.length === 1">
                                <img (click)="openImagePopup(0, post)" [src]="post.images[0].image" alt="Ảnh"
                                    class="object-cover w-full h-full ring-2 ring-gray-200/50" />
                            </div>

                            <!-- 2 ảnh: chia đôi -->
                            <div *ngIf="post.images.length === 2" class="grid grid-cols-2 gap-1">
                                <img *ngFor="let img of post.images; let i = index" (click)="openImagePopup(i, post)"
                                    [src]="img.image" alt="Ảnh" class="object-cover w-full h-full ring-2 ring-gray-200/50" />
                            </div>

                            <!-- 3 ảnh: 1 ảnh trái, 2 ảnh phải -->
                            <div *ngIf="post.images.length === 3" class="grid grid-cols-2 gap-1">
                                <div class="h-full">
                                    <img [src]="post.images[0].image" (click)="openImagePopup(0, post)" alt="Ảnh"
                                        class="object-cover w-full h-full ring-2 ring-gray-200/50" />
                                </div>
                                <div class="flex flex-col h-full gap-1">
                                    <img [src]="post.images[1].image" (click)="openImagePopup(1, post)" alt="Ảnh"
                                        class="flex-1 object-cover w-full h-full ring-2 ring-gray-200/50" />
                                    <img [src]="post.images[2].image" (click)="openImagePopup(2, post)" alt="Ảnh"
                                        class="flex-1 object-cover w-full h-full ring-2 ring-gray-200/50" />
                                </div>
                            </div>

                            <!-- 4 ảnh: chia đều 2x2 -->
                            <div *ngIf="post.images.length === 4" class="grid grid-cols-2 gap-1">
                                <img *ngFor="let img of post.images; let i = index" (click)="openImagePopup(i, post)"
                                    [src]="img.image" alt="Ảnh" class="object-cover w-full h-full ring-2 ring-gray-200/50" />
                            </div>

                            <!-- 5 ảnh: ảnh đầu tiên full, 4 ảnh còn lại 4 cột -->
                            <div *ngIf="post.images.length === 5" class="flex flex-col gap-1">
                                <div>
                                    <img [src]="post.images[0].image" (click)="openImagePopup(0, post)" alt="Ảnh"
                                        class="object-cover w-full h-full ring-2 ring-gray-200/50" />
                                </div>
                                <div class="grid grid-cols-4 gap-1">
                                    <img *ngFor="let img of post.images.slice(1); let i = index"
                                        (click)="openImagePopup(i+1, post)" [src]="img.image" alt="Ảnh"
                                        class="object-cover w-full h-full ring-2 ring-gray-200/50" />
                                </div>
                            </div>

                            <!-- > 5 ảnh: ảnh đầu full, 4 ảnh kế tiếp chia 4 cột, ảnh thứ 5 overlay số dư -->
                            <div *ngIf="post.images.length > 5" class="flex flex-col gap-1">
                                <img [src]="post.images[0].image" (click)="openImagePopup(0, post)" alt="Ảnh"
                                    class="object-cover w-full h-full ring-2 ring-gray-200/50" />
                                <div class="grid grid-cols-4 gap-1">
                                    <ng-container *ngFor="let img of post.images.slice(1, 4); let i = index">
                                        <div class="relative">
                                            <img [src]="img.image" (click)="openImagePopup(i+1, post)" alt="Ảnh"
                                                class="object-cover w-full h-full ring-2 ring-gray-200/50" />
                                        </div>
                                    </ng-container>

                                    <!-- Ảnh cuối có overlay nếu còn dư -->
                                    <div class="relative" *ngIf="post.images.length > 5">
                                        <img [src]="post.images[4].image" (click)="openImagePopup(4, post)" alt="Ảnh"
                                            class="object-cover w-full h-full ring-2 ring-gray-200/50" />
                                        <div *ngIf="post.images.length > 5" (click)="openImagePopup(4, post)"
                                            class="absolute inset-0 flex items-center justify-center text-lg font-semibold text-white bg-black bg-opacity-50">
                                            +{{ post.images.length - 5 }}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </ng-container>

                        <!-- URL nếu có -->
                        <!-- <div *ngIf="post.url" class="mb-2 text-sm text-blue-600 underline break-words">
                            {{ post.url }}
                        </div> -->

                        <!-- Hình ảnh -->
                        <!-- <app-news-images [images]="post.images"></app-news-images> -->

                        <!-- Biểu cảm + tương tác -->
                        <div class="mt-3">
                            <!-- Biểu cảm -->
                            <div class="flex items-center gap-2 mb-2 text-sm">
                                <span class="flex items-center gap-1">
                                    <img src="assets/images/ui/like-icon.svg"
                                        class="object-cover w-5 h-5 rounded-full" />
                                    <span class="cursor-pointer hover:underline" (click)="openLikedUsersPopup(post)">{{
                                        post.likedBy?.total || 0}}</span>
                                </span>
                                <span class="ml-auto text-gray-500 text-md">
                                    {{ commentTotalMap[post.id] || 0 }} {{ translocoService.translate('news-feed.comment') }}
                                </span>
                            </div>

                            <!-- Hành động -->
                            <div class="flex justify-around pt-2 text-sm text-gray-700 border-t">
                                <button *ngIf="!isLiked(post.id)" (click)="likeNews(post.id)"
                                    class="flex items-center gap-1 transition hover:text-blue-600">
                                    <mat-icon [svgIcon]="'heroicons_outline:hand-thumb-up'"></mat-icon><span
                                        class="font-medium">{{ translocoService.translate('news-feed.like') }}</span>
                                </button>
                                <button *ngIf="isLiked(post.id)" (click)="likeNews(post.id)"
                                    class="flex items-center gap-1 transition hover:text-blue-600">
                                    <mat-icon class="text-blue-500"
                                        [svgIcon]="'heroicons_solid:hand-thumb-up'"></mat-icon><span
                                        class="font-medium">{{ translocoService.translate('news-feed.like') }}</span>
                                </button>
                                <button (click)="openDetail(post)"
                                    class="flex items-center gap-1 transition hover:text-blue-600">
                                    <mat-icon
                                        [svgIcon]="'heroicons_outline:chat-bubble-oval-left-ellipsis'"></mat-icon><span
                                        class="font-medium">{{ translocoService.translate('news-feed.comment') }}</span>
                                </button>
                                <button disabled class="flex items-center gap-1 transition hover:text-blue-600">
                                    <mat-icon [svgIcon]="'heroicons_outline:chat-bubble-oval-left'"></mat-icon><span
                                        class="font-medium">{{ translocoService.translate('news-feed.exchange') }}</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </ng-container>
            </div>
            
        </div>
    </div>
</div>

<!-- Full-screen edit overlay -->


<div *ngIf="showCreateNewsPopup" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-40">
    <div class="max-sm:max-w-full max-sm:w-full max-w-[50vw] w-[50vw] max-h-[90vh]">
        <div class="flex items-center justify-between px-4 py-2 rounded-t-lg bg-primary text-on-primary">
            <div class="text-lg font-medium leading-10 text-white">{{ translocoService.translate('news-feed.create_news') }}</div>
            <span class="text-white cursor-pointer material-icons" (click)="closeCreateNewsPopup()">close</span>
        </div>
        <div class="p-4 space-y-4  max-h-[80vh] overflow-y-auto bg-white">
            <!-- User + Danh mục -->
            <div class="flex items-start gap-3">
                <img [src]="currentUser?.avatar || 'assets/images/avatars/default-avatar.svg'" alt="Avatar"
                    class="object-cover w-10 h-10 rounded-full" />
                <div class="flex-1">
                    <div class="mb-2 text-sm font-medium text-black">
                        {{ currentUser.fullName || currentUser.username }}
                    </div>
                    <!-- Danh mục -->
                    <div #categoryDropdownPopup class="relative inline-block w-full">
                        <button (click)="showCategory = !showCategory"
                            class="flex items-center justify-between gap-2 py-1 transition-colors bg-blue-100 rounded-lg ps-2 hover:bg-blue-150"
                            [class.border-blue-500]="selectedCatIds.length > 0" type="button">
                            <span class="flex flex-wrap items-center gap-1 text-md text-primary-700">
                                <ng-container *ngIf="selectedCatIds.length === 0; else selectedList">
                                    {{ translocoService.translate('news-feed.category') }}
                                </ng-container>
                                <ng-template #selectedList>
                                    <ng-container *ngFor="let cat of selectedCat">
                                        <span
                                            class="flex items-center gap-1 px-2 py-0.5  text-blue-800 rounded-lg text-md"
                                            (click)="$event.stopPropagation()">
                                            {{ cat.name }}
                                            <button type="button" class="text-blue-800 hover:text-red-600"
                                                (click)="removeCat(cat.id); $event.stopPropagation();">
                                                ×
                                            </button>
                                        </span>
                                    </ng-container>
                                </ng-template>
                            </span>
                            <mat-icon class="text-sm text-gray-400">keyboard_arrow_down</mat-icon>
                        </button>
                        <!-- Dropdown -->
                        <div *ngIf="showCategory"
                            class="absolute left-0 z-50 w-full mt-1 bg-white rounded-lg shadow-lg top-full">
                            <div class="p-3 border-b border-gray-100">
                                <h3 class="text-sm font-medium text-gray-900">
                                    {{ translocoService.translate('news.category') }}
                                </h3>
                            </div>
                            <div class="overflow-y-auto max-h-30">
                                <label *ngFor="let cat of categories"
                                    class="flex items-center gap-3 px-3 py-2 cursor-pointer hover:bg-gray-50">
                                    <input type="checkbox" [checked]="selectedCatIds.includes(cat.id)"
                                        (change)="onCategorySelect(cat.id, $event)"
                                        class="w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500" />
                                    <span class="flex items-center gap-2 text-sm text-gray-700">
                                        {{ cat.name }}
                                    </span>
                                </label>
                            </div>
                        </div>
                        <span *ngIf="errorFields['categories'] && selectedCatIds.length === 0" class="block mt-1 text-xs text-red-500">
                            {{ translocoService.translate('news-feed.category_required') }}
                        </span>
                    </div>
                </div>
            </div>

            <!-- File (nếu có) -->
            <div *ngIf="newPost.attachments?.length > 0" class="space-y-2">
                <div *ngFor="let att of newPost.attachments"
                    class="flex items-center justify-between p-2 bg-gray-100 rounded-md shadow-sm">
                    <div class="flex items-center gap-2">
                        <!-- Icon PDF hoặc loại file -->
                        <span class="text-orange-500 material-icons">file_present</span>
                        <!-- Tên file -->
                        <span class="text-sm font-medium">{{ att.filename }}</span>
                    </div>

                    <!-- Nút xoá -->
                    <button class="text-gray-500 hover:text-red-500" (click)="removeAttachment(att)">
                        <mat-icon>close</mat-icon>
                    </button>
                </div>
            </div>

            <!-- Textarea -->
            <textarea [(ngModel)]="newPost.content" name="content"
                placeholder="{{ translocoService.translate('news.content_placeholder') }}" class="block w-full p-2 resize-none"
                rows="4"></textarea>


            <!-- Ảnh (nếu có) -->
            <div *ngIf="newPost.images?.length > 0" class="relative">
                <!-- 1 ảnh -->
                <div *ngIf="newPost.images.length == 1" class="relative">
                    <img [src]="newPost.images[0]"
                        class="object-cover w-full h-full ring-2 ring-gray-200/50" />
                    <button (click)="removeImage(0)"
                        class="absolute flex items-center justify-center w-6 h-6 text-white rounded-full top-2 right-2 bg-black/50">
                        <mat-icon class="text-sm text-white">close</mat-icon>
                    </button>
                </div>

                <div *ngIf="newPost.images?.length === 2" class="grid grid-cols-2 gap-1">
                    <div *ngFor="let img of newPost.images; let i = index" class="relative">
                        <img [src]="img" alt="Ảnh" class="object-cover w-full h-full ring-2 ring-gray-200/50" />
                        <button (click)="removeImage(i)"
                            class="absolute flex items-center justify-center w-6 h-6 text-white rounded-full top-1 right-1 bg-black/50">
                            <mat-icon class="text-sm text-white">close</mat-icon>
                        </button>
                    </div>
                </div>

                <div *ngIf="newPost.images.length === 3" class="grid grid-cols-2 gap-1">
                    <div class="relative h-full">
                        <img [src]="newPost.images[0]" alt="Ảnh" class="object-cover w-full h-full ring-2 ring-gray-200/50" />
                        <button (click)="removeImage(0)"
                            class="absolute flex items-center justify-center w-6 h-6 text-white rounded-full top-1 right-1 bg-black/50">
                            <mat-icon class="text-sm text-white">close</mat-icon>
                        </button>
                    </div>
                    <div class="flex flex-col h-full gap-1">
                        <div class="relative flex-1">
                            <img [src]="newPost.images[1]" alt="Ảnh" class="object-cover w-full h-full ring-2 ring-gray-200/50" />
                            <button (click)="removeImage(1)"
                                class="absolute flex items-center justify-center w-6 h-6 text-white rounded-full top-1 right-1 bg-black/50">
                                <mat-icon class="text-sm text-white">close</mat-icon>
                            </button>
                        </div>
                        <div class="relative flex-1">
                            <img [src]="newPost.images[2]" alt="Ảnh" class="object-cover w-full h-full ring-2 ring-gray-200/50" />
                            <button (click)="removeImage(2)"
                                class="absolute flex items-center justify-center w-6 h-6 text-white rounded-full top-1 right-1 bg-black/50">
                                <mat-icon class="text-sm text-white">close</mat-icon>
                            </button>
                        </div>
                    </div>
                </div>

                <div *ngIf="newPost.images.length === 4" class="grid grid-cols-2 gap-1">
                    <div *ngFor="let img of newPost.images; let i = index" class="relative">
                        <img [src]="img" alt="Ảnh" class="object-cover w-full h-full ring-2 ring-gray-200/50" />
                        <button (click)="removeImage(i)"
                            class="absolute flex items-center justify-center w-6 h-6 text-white rounded-full top-1 right-1 bg-black/50">
                            <mat-icon class="text-sm text-white">close</mat-icon>
                        </button>
                    </div>
                </div>

                <!-- 5 ảnh: ảnh đầu tiên full, 4 ảnh còn lại 4 cột -->
                <div *ngIf="newPost.images.length === 5" class="flex flex-col gap-1">
                    <div class="relative">
                        <img [src]="newPost.images[0]" class="object-cover w-full h-full ring-2 ring-gray-200/50" />
                        <button (click)="removeImage(0)"
                            class="absolute flex items-center justify-center w-6 h-6 text-white rounded-full top-1 right-1 bg-black/50">
                            <mat-icon class="text-sm text-white">close</mat-icon>
                        </button>
                    </div>
                    <div class="grid grid-cols-4 gap-1">
                        <div *ngFor="let img of newPost.images.slice(1); let i = index" class="relative">
                            <img [src]="img" class="object-cover w-full h-full ring-2 ring-gray-200/50" />
                            <button (click)="removeImage(i + 1)"
                                class="absolute flex items-center justify-center w-6 h-6 text-white rounded-full top-1 right-1 bg-black/50">
                                <mat-icon class="text-sm text-white">close</mat-icon>
                            </button>
                        </div>
                    </div>
                </div>


                <!-- > 5 ảnh: ảnh đầu full, 4 ảnh kế tiếp chia 4 cột, ảnh thứ 5 overlay số dư -->
                <div *ngIf="newPost.images.length > 5" class="flex flex-col gap-1">
                    <div class="relative">
                        <img [src]="newPost.images[0]" class="object-cover w-full h-full ring-2 ring-gray-200/50" />
                        <button (click)="removeImage(0)"
                            class="absolute flex items-center justify-center w-6 h-6 text-white rounded-full top-1 right-1 bg-black/50">
                            <mat-icon class="text-sm text-white">close</mat-icon>
                        </button>
                    </div>
                    <div class="grid grid-cols-4 gap-1">
                        <div *ngFor="let img of newPost.images.slice(1, 5); let i = index" class="relative">
                            <img [src]="img" class="object-cover w-full h-full ring-2 ring-gray-300/50" />
                            <button (click)="removeImage(i + 1)"
                                class="absolute flex items-center justify-center w-6 h-6 text-white rounded-full top-1 right-1 bg-black/50">
                                <mat-icon class="text-sm text-white">close</mat-icon>
                            </button>

                            <!-- Overlay nếu là ảnh cuối -->
                            <div *ngIf="i === 3 && newPost.images.length > 5"
                                class="absolute inset-0 flex items-center justify-center text-lg font-semibold text-white bg-black bg-opacity-50">
                                +{{ newPost.images.length - 5 }}
                            </div>
                        </div>
                    </div>
                </div>

            </div>

            <!-- Chọn ảnh & file -->
            <div class="flex justify-around pt-2 border-t border-gray-200">
                <label class="flex items-center gap-2 text-sm text-gray-600 cursor-pointer">
                    <mat-icon class="text-green-500" [svgIcon]="'heroicons_solid:photo'"></mat-icon>
                    {{ translocoService.translate('news-feed.image') }}
                    <input accept="image/*" type="file" hidden (change)="onImageChange($event)" multiple />
                </label>
                <label class="flex items-center gap-2 text-sm text-gray-600 cursor-pointer">
                    <span class="text-orange-500 material-icons">file_present</span>File
                    <input type="file" hidden (change)="onFileChange($event)" multiple />
                </label>
            </div>

            <!-- Nút đăng -->
            <button (click)="createdPost(newPost)"
                class="w-full py-2 mt-2 font-medium text-white rounded bg-primary">
                {{ translocoService.translate('news-feed.post') }}
            </button>
        </div>
    </div>
</div>

<!-- Popup danh sách người thích -->
<div *ngIf="showLikedUsersPopup" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-40">
    <div class=" rounded-lg shadow-lg bg-white p-6 min-w-[320px] max-w-[90vw]">
        <h3 class="mb-4 text-lg font-semibold">{{ translocoService.translate("news.list_liked") }}</h3>
        <ul class="mb-4 overflow-y-auto max-h-60">
            <li *ngFor="let user of likedUsers" class="flex items-center gap-2 py-1 border-b last:border-b-0">
                <img *ngIf="user.avatar" [src]="user.avatar" alt="avatar"
                    class="object-cover w-8 h-8 border border-gray-300 rounded-full" />
                <span *ngIf="!user.avatar"
                    class="flex items-center justify-center w-8 h-8 text-sm font-bold text-gray-500 bg-gray-200 border border-gray-300 rounded-full">
                    {{ user.username ? user.username.charAt(0).toUpperCase() : '?' }}
                </span>
                <span>{{ user.username }}</span>
            </li>
            <li *ngIf="!likedUsers || likedUsers.length === 0" class="italic text-gray-500">{{
                translocoService.translate("news.no_like") }}</li>
        </ul>
        <button (click)="closeLikedUsersPopup()" class="px-4 py-2 text-white bg-blue-600 rounded hover:bg-blue-700">
            {{ translocoService.translate("news.btn_close") }}
        </button>
    </div>
</div>

<!-- Popup xem ảnh + bình luận -->
<div *ngIf="showImageViewPopup && selectedPost"
    class="fixed inset-0 z-[201] bg-black bg-opacity-90 flex items-center justify-center">
    <!-- Khung 2 cột -->
    <div class="w-full h-full max-w-[100vw] max-h-[100vh]  flex max-sm:flex-col sm:overflow-hidden shadow-lg">
        <!-- Ảnh bên trái -->
        <div class="relative flex items-center max-sm:h-[45%] h-[700px] justify-center flex-1 bg-black">
            <!-- Nút đóng -->
            <button (click)="closeImagePopup()" class="absolute flex items-center justify-center w-10 h-10 text-2xl text-white bg-gray-700 bg-opacity-50 rounded-full top-5 left-4 hover:bg-opacity-70">
                <mat-icon class="text-lg text-white">close</mat-icon>
            </button>
            <img [src]="selectedPost.images[selectedImageIndex].image" class="max-h-[90vh] max-w-full  object-contain" />

            <!-- Prev/Next -->
            <button *ngIf="selectedImageIndex > 0" (click)="selectedImageIndex = selectedImageIndex - 1" class="absolute flex items-center justify-center w-10 h-10 text-2xl text-white transition transform -translate-y-1/2 bg-gray-700 bg-opacity-50 rounded-full left-4 top-1/2 hover:bg-opacity-70">
                ‹
            </button>
            <button *ngIf="selectedImageIndex < selectedPost.images.length - 1"
                (click)="selectedImageIndex = selectedImageIndex + 1" class="absolute flex items-center justify-center w-10 h-10 text-2xl text-white transition transform -translate-y-1/2 bg-gray-700 bg-opacity-50 rounded-full right-4 top-1/2 hover:bg-opacity-70">
                ›
            </button>
        </div>

        <!-- Bình luận bên phải -->
        <div class="max-sm:w-full max-sm:h-[55%] w-[400px] h-full p-4 flex flex-col bg-white">
            <div class="flex-1 space-y-3 overflow-y-auto">
                <!-- Thông tin người đăng -->
                <div class="flex items-center gap-2 mb-3">
                    <img [src]="selectedPost.createdBy?.avatar || 'assets/images/avatars/default-avatar.svg'"
                        class="object-cover w-10 h-10 rounded-full" />
                    <div>
                        <div class="font-semibold">{{ selectedPost.createdBy?.username }}</div>
                        <div class="text-xs text-gray-500">{{ selectedPost.createdAt | date : "dd/MM/yyyy HH:mm" }}
                        </div>
                    </div>
                </div>
                <div *ngIf="selectedPost.categories?.length > 0" class="flex flex-wrap gap-2 mb-2">
                    <span *ngFor="let cat of selectedPost.categories"
                        class="px-2 py-1 text-xs text-gray-800 bg-gray-100 rounded">{{ cat.name | titlecase }}
                    </span>
                </div>

                <div *ngIf="selectedPost.attachments?.length > 0" class="mb-2 space-y-2">
                    <div *ngFor="let att of selectedPost.attachments"
                        class="flex items-center justify-between p-2 bg-gray-100 rounded-md shadow-sm">
                        <div class="flex items-center gap-2">
                            <!-- Icon file -->
                            <span class="text-orange-500 material-icons">file_present</span>

                            <!-- Link tải file -->
                            <a [href]="att.file" [download]="att.filename"
                                class="text-sm font-medium text-blue-600 hover:underline" target="_blank"
                                rel="noopener noreferrer">
                                {{ att.filename }}
                            </a>
                        </div>
                    </div>
                </div>


                <!-- Nội dung không có ảnh -->
                <div class="mb-2 text-sm text-gray-800 break-words whitespace-pre-line" 
                    [ngClass]="{ 'line-clamp-2': !isExpanded(selectedPost.id) }">
                    {{ selectedPost.content }}
                </div>
                
                <!-- Hiển thị nút nếu nội dung có vẻ dài (tuỳ ý, bạn có thể cải tiến sau khi tính toán độ dài) -->
                <button
                    *ngIf="isClamped(selectedPost)"
                    class="text-sm font-medium text-blue-600 hover:underline"
                    (click)="toggleExpand(selectedPost.id)">
                    {{ isExpanded(selectedPost.id) 
                        ? translocoService.translate('news-feed.hide') 
                        : translocoService.translate('news-feed.expand') }}
                </button>
                

                <div class="mt-3">
                    <!-- Biểu cảm -->
                    <div class="flex items-center gap-2 mb-2 text-sm">
                        <span class="flex items-center gap-1">
                            <img src="assets/images/ui/like-icon.svg" class="object-cover w-5 h-5 rounded-full" />
                            <span class="cursor-pointer hover:underline" (click)="openLikedUsersPopup(post)">{{
                                selectedPost.likedBy?.total || 0}}</span>
                        </span>
                        <span class="ml-auto text-gray-500 text-md">
                            {{ commentTotalMap[selectedPost.id] || 0 }} {{ translocoService.translate('news-feed.comment') }}
                        </span>
                    </div>

                    <!-- Hành động -->
                    <div class="flex justify-around py-2 text-sm text-gray-700 border-y">
                        <button *ngIf="!isLiked(selectedPost.id)" (click)="likeNews(selectedPost.id)"
                            class="flex items-center gap-1 transition hover:text-blue-600">
                            <mat-icon [svgIcon]="'heroicons_outline:hand-thumb-up'"></mat-icon><span
                                class="font-medium">{{ translocoService.translate('news-feed.like') }}</span>
                        </button>
                        <button *ngIf="isLiked(selectedPost.id)" (click)="likeNews(selectedPost.id)"
                            class="flex items-center gap-1 transition hover:text-blue-600">
                            <mat-icon class="text-blue-500" [svgIcon]="'heroicons_solid:hand-thumb-up'"></mat-icon><span
                                class="font-medium">{{ translocoService.translate('news-feed.like') }}</span>
                        </button>
                        <button (click)="focusCommentInput()"
                            class="flex items-center gap-1 transition hover:text-blue-600">
                            <mat-icon [svgIcon]="'heroicons_outline:chat-bubble-oval-left-ellipsis'"></mat-icon><span
                                class="font-medium">{{ translocoService.translate('news-feed.comment') }}</span>
                        </button>
                        <button disabled class="flex items-center gap-1 transition hover:text-blue-600">
                            <mat-icon [svgIcon]="'heroicons_outline:chat-bubble-oval-left'"></mat-icon><span
                                class="font-medium">{{ translocoService.translate('news-feed.exchange') }}</span>
                        </button>
                    </div>
                </div>

                <!-- Danh sách bình luận -->
                <div class="mt-2 space-y-3 overflow-y-auto shrink">
                    <div *ngFor="let cmt of commentOfNews" class="flex items-start w-full gap-2">
                        <!-- Avatar -->
                        <img [src]="cmt.user?.avatar || 'assets/images/avatars/default-avatar.svg'"
                            class="object-cover rounded-full w-9 h-9" />

                        <!-- Nội dung bình luận -->
                        <div class="flex flex-col w-full">
                            <div class="w-full px-4 py-2 bg-gray-100 rounded-2xl">
                                <div class="text-sm font-semibold leading-tight">{{ cmt.user?.username }}</div>
                                <div class="text-sm">{{ cmt.content }}</div>
                            </div>

                            <!-- Thời gian + hành động -->
                            <div class="flex items-center gap-3 px-1 mt-1 text-xs text-gray-500">
                                <span>{{ getTimeAgo(cmt.createdAt) }}</span>
                                <button *ngIf="!isLikedCmt(cmt.id)" class="hover:underline"
                                    (click)="likeComment(cmt.id)">{{ translocoService.translate('news-feed.like') }}</button>
                                <button *ngIf="isLikedCmt(cmt.id)" class="font-semibold text-blue-700 hover:underline"
                                    (click)="likeComment(cmt.id)">{{ translocoService.translate('news-feed.like') }}</button>
                                <button class="hover:underline">{{ translocoService.translate('news-feed.reply') }}</button>
                                <!-- Like icon (nếu có like) -->
                                <div *ngIf="cmt.likedBy?.total > 0" 
                                    class="flex items-center ml-2 text-xs"
                                    [ngClass]="isLikedCmt(cmt.id) ? 'text-blue-600' : 'text-gray-500'">
                                    <div class="flex items-center gap-1 px-2 py-1">
                                        <img src="assets/images/ui/like-icon.svg"
                                                class="object-cover w-4 h-4 rounded-full" />
                                        <span>{{ cmt.likedBy?.total }}</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
            <!-- Ô nhập bình luận -->
            <div class="flex items-start gap-2 mt-4">
                <img [src]="currentUser?.avatar || 'assets/images/avatars/default-avatar.svg'"
                    class="object-cover rounded-full w-9 h-9" />

                <textarea [(ngModel)]="newComment.content" 
                    #commentInput name="content" 
                    placeholder="{{ translocoService.translate('news-feed.comment_placeholder') }}"
                    class="flex-1 px-3 py-2 text-sm border rounded-lg resize-none" rows="3">
                </textarea>
                <button (click)="sendComment(selectedPost.id, newComment)"
                    class="flex items-center justify-center w-10 h-10 text-sm font-medium bg-gray-100 rounded-full">
                    <!-- <mat-icon class="w-2 h-2 text-gray-400" [svgIcon]="'heroicons_solid:paper-airplane'"></mat-icon> -->
                    <img 
                        [src]="newComment?.content?.trim() 
                        ? 'assets/images/ui/icon-active.svg' 
                        : 'assets/images/ui/icon-disable.svg'" 
                        alt="">
                </button>
            </div>
        </div>
    </div>
</div>


<!-- Popup xem bình luận -->
<div *ngIf="showCommentViewPopup && selectedPost"
    class="fixed inset-0 z-[201] bg-gray-500 bg-opacity-90 flex items-center justify-center">
    <div class="w-full h-full max-w-[400px] max-h-[90vh] max-sm:max-h-full flex overflow-hidden shadow-lg">
        <div class="w-[400px] h-[90vh] max-sm:h-full bg-white p-4 flex flex-col">
            <!-- Bình luận  -->
            <button (click)="closeDetail()" class="absolute flex items-center justify-center w-10 h-10 text-2xl text-white bg-gray-700 bg-opacity-50 rounded-full top-5 right-4 hover:bg-opacity-70">
                <mat-icon class="text-lg text-white">close</mat-icon>
            </button>
            <div class="flex-1 space-y-3 overflow-y-auto">
                <!-- Thông tin người đăng -->
                <div class="flex items-center gap-2 mb-3">
                    <img [src]="selectedPost.createdBy?.avatar || 'assets/images/avatars/default-avatar.svg'"
                        class="object-cover w-10 h-10 rounded-full" />
                    <div>
                        <div class="font-semibold">{{ selectedPost.createdBy?.username }}</div>
                        <div class="text-xs text-gray-500">{{ selectedPost.createdAt | date : "dd/MM/yyyy HH:mm" }}
                        </div>
                    </div>
                </div>
                <div *ngIf="selectedPost.categories?.length > 0" class="flex flex-wrap gap-2 mb-2">
                    <span *ngFor="let cat of selectedPost.categories"
                        class="px-2 py-1 text-xs text-gray-800 bg-gray-100 rounded">{{ cat.name | titlecase }}
                    </span>
                </div>
                <!-- file -->
                <div *ngIf="selectedPost.attachments?.length > 0" class="mb-2 space-y-2">
                    <div *ngFor="let att of selectedPost.attachments"
                        class="flex items-center justify-between p-2 bg-gray-100 rounded-md shadow-sm">
                        <div class="flex items-center gap-2">
                            <!-- Icon file -->
                            <span class="text-orange-500 material-icons">file_present</span>

                            <!-- Link tải file -->
                            <a [href]="att.file" [download]="att.filename"
                                class="text-sm font-medium text-blue-600 hover:underline" target="_blank"
                                rel="noopener noreferrer">
                                {{ att.filename }}
                            </a>
                        </div>
                    </div>
                </div>

                <!-- Nội dung không có ảnh -->
                <div class="mb-2 text-sm text-gray-800 line-clamp-2" [innerHTML]="selectedPost.content"></div>

                <div class="mt-3">
                    <!-- Biểu cảm -->
                    <div class="flex items-center gap-2 mb-2 text-sm">
                        <span class="flex items-center gap-1">
                            <img src="assets/images/ui/like-icon.svg" class="object-cover w-5 h-5 rounded-full" />
                            <span class="cursor-pointer hover:underline" (click)="openLikedUsersPopup(post)">{{
                                selectedPost.likedBy?.total || 0}}</span>
                        </span>
                        <span class="ml-auto text-gray-500 text-md">{{ commentTotalMap[selectedPost.id] || 0 }} bình
                            luận</span>
                    </div>

                    <!-- Hành động -->
                    <div class="flex justify-around py-2 text-sm text-gray-700 border-y">
                        <button *ngIf="!isLiked(selectedPost.id)" (click)="likeNews(selectedPost.id)"
                            class="flex items-center gap-1 transition hover:text-blue-600">
                            <mat-icon [svgIcon]="'heroicons_outline:hand-thumb-up'"></mat-icon><span
                                class="font-medium">{{ translocoService.translate('news-feed.like') }}</span>
                        </button>
                        <button *ngIf="isLiked(selectedPost.id)" (click)="likeNews(selectedPost.id)"
                            class="flex items-center gap-1 transition hover:text-blue-600">
                            <mat-icon class="text-blue-500" [svgIcon]="'heroicons_solid:hand-thumb-up'"></mat-icon><span
                                class="font-medium">{{ translocoService.translate('news-feed.like') }}</span>
                        </button>
                        <button (click)="focusCommentInput()"
                            class="flex items-center gap-1 transition hover:text-blue-600">
                            <mat-icon [svgIcon]="'heroicons_outline:chat-bubble-oval-left-ellipsis'"></mat-icon><span
                                class="font-medium">{{ translocoService.translate('news-feed.comment') }}</span>
                        </button>
                        <button disabled class="flex items-center gap-1 transition hover:text-blue-600">
                            <mat-icon [svgIcon]="'heroicons_outline:chat-bubble-oval-left'"></mat-icon><span
                                class="font-medium">{{ translocoService.translate('news-feed.exchange') }}</span>
                        </button>
                    </div>
                </div>

                <!-- Danh sách bình luận -->
                <div class="mt-2 space-y-3">
                    <div *ngFor="let cmt of commentOfNews" class="flex items-start w-full gap-2">
                        <!-- Avatar -->
                        <img [src]="cmt.user?.avatar || 'assets/images/avatars/default-avatar.svg'"
                            class="object-cover rounded-full w-9 h-9" />

                        <!-- Nội dung bình luận -->
                        <div class="flex flex-col w-full">
                            <div class="w-full px-4 py-2 bg-gray-100 rounded-2xl">
                                <div class="text-sm font-semibold leading-tight">{{ cmt.user?.username }}</div>
                                <div class="text-sm">{{ cmt.content }}</div>
                            </div>

                            <!-- Thời gian + hành động -->
                            <div class="flex items-center gap-3 px-1 mt-1 text-xs text-gray-500">
                                <span>{{ getTimeAgo(cmt.createdAt) }}</span>
                                <button *ngIf="!isLikedCmt(cmt.id)" class="hover:underline"
                                    (click)="likeComment(cmt.id)">{{ translocoService.translate('news-feed.like') }}</button>
                                <button *ngIf="isLikedCmt(cmt.id)" class="font-semibold text-blue-700 hover:underline"
                                    (click)="likeComment(cmt.id)">{{ translocoService.translate('news-feed.like') }}</button>
                                <button class="hover:underline">{{ translocoService.translate('news-feed.reply') }}</button>
                                <!-- Like icon (nếu có like) -->
                                <div *ngIf="cmt.likedBy?.total > 0" 
                                    class="flex items-center ml-2 text-xs"
                                    [ngClass]="isLikedCmt(cmt.id) ? 'text-blue-600' : 'text-gray-500'">
                                    <div class="flex items-center gap-1 px-2 py-1">
                                        <img src="assets/images/ui/like-icon.svg"
                                                class="object-cover w-4 h-4 rounded-full" />
                                        <span>{{ cmt.likedBy?.total }}</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
            <!-- Ô nhập bình luận -->
            <div class="flex items-start gap-2 mt-4">
                <img [src]="currentUser?.avatar || 'assets/images/avatars/default-avatar.svg'"
                    class="object-cover rounded-full w-9 h-9" />

                <textarea [(ngModel)]="newComment.content" 
                    #commentInput name="content" 
                    placeholder="{{ translocoService.translate('news-feed.comment_placeholder') }}"
                    class="flex-1 px-3 py-2 text-sm border rounded-lg" rows="3"></textarea>
                <button (click)="sendComment(selectedPost.id, newComment)"
                    class="flex items-center justify-center w-10 h-10 text-sm font-medium bg-gray-100 rounded-full">
                    <button (click)="sendComment(selectedPost.id, newComment)"
                    class="flex items-center justify-center w-10 h-10 text-sm font-medium bg-gray-100 rounded-full">
                    <!-- <mat-icon class="w-2 h-2 text-gray-400" [svgIcon]="'heroicons_solid:paper-airplane'"></mat-icon> -->
                    <img 
                        [src]="newComment?.content?.trim() 
                        ? 'assets/images/ui/icon-active.svg' 
                        : 'assets/images/ui/icon-disable.svg'" 
                        alt="">
                </button>
                </button>
            </div>
        </div>
    </div>
</div>
